System.register("chunks:///_virtual/Bomb2dUnit.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"e9a51HNWkFIHI0OdMOKLDyP","Bomb2dUnit",void 0);t("Bomb2dUnit",(function(){this.moveX=void 0,this.moveY=void 0,this.userId=void 0,this.propType=void 0}));i._RF.pop()}}}));

System.register("chunks:///_virtual/BoxItemComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataWarehouse.ts","./JsonCMD.ts","./NetworkManager.ts","./GameSceneUIManager.ts"],(function(e){var t,o,r,i,n,a,p,l,s,c,u,m,h,v,g,f,d,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,p=e.Sprite,l=e.Node,s=e.Button,c=e.SpriteFrame,u=e.Color,m=e.assetManager,h=e.Texture2D,v=e.Component},function(e){g=e.DataWarehouse},function(e){f=e.JsonCMD},function(e){d=e.NetworkManager},function(e){S=e.GameSceneUIManager}],execute:function(){var b,I,y,C,x,w,B,F,M,z,D,T,N,P,A,k;n._RF.push({},"daaccICo8tJ/Z1iVWFo1eiW","BoxItemComp",void 0);var X=a.ccclass,Y=a.property;e("BoxItemComp",(b=X("BoxItemComp"),I=Y(p),y=Y(p),C=Y(l),x=Y(s),w=Y(Number),B=Y(Number),b(((k=function(e){function t(){for(var t,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return t=e.call.apply(e,[this].concat(n))||this,r(t,"propSprite",z,i(t)),r(t,"openSprite",D,i(t)),r(t,"peopleItem",T,i(t)),r(t,"boxBtn",N,i(t)),r(t,"moveX",P,i(t)),r(t,"moveY",A,i(t)),t.avatarSp=void 0,t.circleSp=void 0,t.isOpened=!1,t}o(t,e);var n=t.prototype;return n.start=function(){var e=this;this.avatarSp=this.peopleItem.getChildByName("AvatarImg").getComponent(p),this.circleSp=this.peopleItem.getChildByName("Avatarbg").getComponent(p),this.openSprite.node.active=!1,this.propSprite.node.active=!1,this.peopleItem.active=!1,this.boxBtn.node.on("click",(function(){if(S.isAllowSel){if(console.log("===click open box===",e.moveX,e.moveY),g.startZoom)return g.instance.requestUsingOneZoomPropForMainPlayer(e.moveX,e.moveY),void(g.startZoom=!1);if(!e.isOpened){var t=f.C2S_playerMove(e.moveX,e.moveY);d.instance.sendMsg2Server(t),e.isOpened=!0}}else console.log("====not allow local sel bomb====")}))},n.openBox=function(e,t,o){this.openSprite.node.active=!0,this.propSprite.node.active=!0,this.propSprite.spriteFrame=new c;var r=S.getPropTex2d(e);console.log("openBox===propType=="+e.toString()),console.log("openBox===propType name=="+r.name.toString()),this.propSprite.spriteFrame.texture=r,this.propSprite.node.width=25,this.propSprite.node.height=25,this.peopleItem.active=!0,null!=o&&""!=o&&this.setAvatar(o),t&&this.setIsCurrentPlayer(!0)},n.setIsCurrentPlayer=function(e){this.setCircleColor(this.hexToColor("#FF9F04"))},n.setCircleColor=function(e){this.circleSp.color=e,console.log("setcirclecolor=="+e)},n.hexToColor=function(e){if(6===(e=e.replace(/^#/,"")).length)return new u(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16));if(8===e.length)return new u(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16),parseInt(e.slice(6,8),16));throw new Error("Invalid hex color format")},n.setAvatar=function(e){var t=this;try{m.loadRemote(e,{ext:".png"},(function(o,r){if(console.log("url",e),o)console.error("Failed to load image:",o);else{var i=new c,n=new h;n.image=r,i.texture=n,t.avatarSp.spriteFrame=i}}))}catch(e){console.log("===set avatar==="+e)}},n.closeBox=function(){this.openSprite.node.active=!1,this.propSprite.node.active=!1,this.peopleItem.active=!1},n.update=function(e){},t}(v)).propType=void 0,z=t((M=k).prototype,"propSprite",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(M.prototype,"openSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(M.prototype,"peopleItem",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=t(M.prototype,"boxBtn",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=t(M.prototype,"moveX",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=t(M.prototype,"moveY",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=M))||F));n._RF.pop()}}}));

System.register("chunks:///_virtual/ChoosePropViewComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataWarehouse.ts","./SelectPropItemComp.ts","./GameSceneUIManager.ts"],(function(e){var t,o,r,n,i,c,a,l,s,p,u,f,m,P,b,d,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){i=e.cclegacy,c=e._decorator,a=e.Button,l=e.Node,s=e.Label,p=e.Prefab,u=e.instantiate,f=e.Component},function(e){m=e.PropType,P=e.DataWarehouse},function(e){b=e.selectPropItemEventTarget,d=e.SelectPropItemComp},function(e){h=e.GameSceneUIManager}],execute:function(){var g,y,C,S,v,w,I,B,T,D,L,z,k;i._RF.push({},"49c79dfhwBB1ZbmouQAS5ni","ChoosePropViewComp",void 0);var N=c.ccclass,V=c.property;e("ChoosePropViewComp",(g=N("ChoosePropViewComp"),y=V(a),C=V(a),S=V(l),v=V(s),w=V(p),g((T=t((B=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return t=e.call.apply(e,[this].concat(i))||this,r(t,"closeBtn",T,n(t)),r(t,"confirmBtn",D,n(t)),r(t,"grid",L,n(t)),r(t,"descLabel",z,n(t)),t.curSelPropType=m.None,r(t,"selectPropItemPrefab",k,n(t)),t}o(t,e);var i=t.prototype;return i.start=function(){var e=this;this.closeBtn.node.on("click",(function(){h.propsViewNode=null,e.node.destroy()}),this),this.confirmBtn.node.on("click",(function(){e.curSelPropType==m.Next?P.instance.requestUsingOnePropForMainPlayer(e.curSelPropType):e.curSelPropType==m.Zoom&&(P.startZoom=!0),h.propsViewNode=null,e.node.destroy()}),this)},i.onDestroy=function(){b.off("selectPropItemEvent")},i.initData=function(e){var t=this;e.forEach((function(e){var o=u(t.selectPropItemPrefab);o.getComponent(d).initData(e),b.on("selectPropItemEvent",(function(e){console.log("selectPropItem",e),t.curSelPropType=e,t.updateDesc(),t.resetSelectPropComp(e)}),t),t.grid.addChild(o)}))},i.updateDesc=function(){switch(this.curSelPropType){case m.Bomb:this.descLabel.string="炸弹";break;case m.Zoom:this.descLabel.string="放大镜";break;case m.Next:this.descLabel.string="跳过";break;case m.Coin:this.descLabel.string="金币"}},i.resetSelectPropComp=function(e){this.grid.children.forEach((function(t){var o=t.getComponent(d);o.getPropType()==e?(o.select(),console.log("reset selectPropItem===="+e)):(o.unSelect(),console.log("reset unselectPropItem===="+o.getPropType()))}))},i.update=function(e){},t}(f)).prototype,"closeBtn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(B.prototype,"confirmBtn",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(B.prototype,"grid",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=t(B.prototype,"descLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=t(B.prototype,"selectPropItemPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=B))||I));i._RF.pop()}}}));

System.register("chunks:///_virtual/colyseus.js",["./cjs-loader.mjs"],(function(t,e){var n;return{setters:[function(t){n=t.default}],execute:function(){t("default",void 0);var o=t("__cjsMetaURL",e.meta.url);n.define(o,(function(e,n,o,r,i){!function(t,n){"object"==typeof e&&void 0!==o?n(e):"function"==typeof define&&define.amd?define("colyseus.js",["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).Colyseus={})}(this,(function(t){function e(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return null!==t&&"object"==typeof t&&t.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var r,i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function s(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))}function a(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function c(t,e,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(t):o?o.value:e.get(t)}function f(t,e,n,o,r){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?r.call(t,n):r?r.value=n:e.set(t,n),n}!function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(r||(r={}));var h=function(t){function e(e,n){var o=t.call(this,n)||this;return o.name="ServerError",o.code=e,o}return o(e,t),e}(Error);function u(t,e){if(this._offset=e,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}u.prototype._array=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=this._parse();return e},u.prototype._map=function(t){for(var e={},n=0;n<t;n++)e[this._parse()]=this._parse();return e},u.prototype._str=function(t){var e=function(t,e,n){for(var o="",r=0,i=e,s=e+n;i<s;i++){var a=t.getUint8(i);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&t.getUint8(++i))<<12|(63&t.getUint8(++i))<<6|(63&t.getUint8(++i))<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r)}else o+=String.fromCharCode((15&a)<<12|(63&t.getUint8(++i))<<6|(63&t.getUint8(++i))<<0);else o+=String.fromCharCode((31&a)<<6|63&t.getUint8(++i));else o+=String.fromCharCode(a)}return o}(this._view,this._offset,t);return this._offset+=t,e},u.prototype._bin=function(t){var e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e},u.prototype._parse=function(){var t,e=this._view.getUint8(this._offset++),n=0,o=0,r=0,i=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var s=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),i=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+i)+s/1e6)}return[o,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(n)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,r+i;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,r+i;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(r=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+i)):-1===o?(r=this._view.getUint32(this._offset),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+i)+(r>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")};function d(t,e,n){for(var o=0,r=0,i=n.length;r<i;r++)(o=n.charCodeAt(r))<128?t.setUint8(e++,o):o<2048?(t.setUint8(e++,192|o>>6),t.setUint8(e++,128|63&o)):o<55296||o>=57344?(t.setUint8(e++,224|o>>12),t.setUint8(e++,128|o>>6&63),t.setUint8(e++,128|63&o)):(r++,o=65536+((1023&o)<<10|1023&n.charCodeAt(r)),t.setUint8(e++,240|o>>18),t.setUint8(e++,128|o>>12&63),t.setUint8(e++,128|o>>6&63),t.setUint8(e++,128|63&o))}function p(t,e,n){var o=typeof n,r=0,i=0,s=0,a=0,c=0,f=0;if("string"===o){if((c=function(t){for(var e=0,n=0,o=0,r=t.length;o<r;o++)(e=t.charCodeAt(o))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(o++,n+=4);return n}(n))<32)t.push(160|c),f=1;else if(c<256)t.push(217,c),f=2;else if(c<65536)t.push(218,c>>8,c),f=3;else{if(!(c<4294967296))throw new Error("String too long");t.push(219,c>>24,c>>16,c>>8,c),f=5}return e.push({_str:n,_length:c,_offset:t.length}),f+c}if("number"===o)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(t.push(n),1):n<256?(t.push(204,n),2):n<65536?(t.push(205,n>>8,n),3):n<4294967296?(t.push(206,n>>24,n>>16,n>>8,n),5):(s=n/Math.pow(2,32)>>0,a=n>>>0,t.push(207,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):n>=-32?(t.push(n),1):n>=-128?(t.push(208,n),2):n>=-32768?(t.push(209,n>>8,n),3):n>=-2147483648?(t.push(210,n>>24,n>>16,n>>8,n),5):(s=Math.floor(n/Math.pow(2,32)),a=n>>>0,t.push(211,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):(t.push(203),e.push({_float:n,_length:8,_offset:t.length}),9);if("object"===o){if(null===n)return t.push(192),1;if(Array.isArray(n)){if((c=n.length)<16)t.push(144|c),f=1;else if(c<65536)t.push(220,c>>8,c),f=3;else{if(!(c<4294967296))throw new Error("Array too large");t.push(221,c>>24,c>>16,c>>8,c),f=5}for(r=0;r<c;r++)f+=p(t,e,n[r]);return f}if(n instanceof Date){var h=n.getTime(),u=Math.floor(h/1e3),d=1e6*(h-1e3*u);return u>=0&&d>=0&&u<=17179869183?0===d&&u<=4294967295?(t.push(214,255,u>>24,u>>16,u>>8,u),6):(s=u/4294967296,a=4294967295&u,t.push(215,255,d>>22,d>>14,d>>6,s,a>>24,a>>16,a>>8,a),10):(s=Math.floor(u/4294967296),a=u>>>0,t.push(199,12,255,d>>24,d>>16,d>>8,d,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),15)}if(n instanceof ArrayBuffer){if((c=n.byteLength)<256)t.push(196,c),f=2;else if(c<65536)t.push(197,c>>8,c),f=3;else{if(!(c<4294967296))throw new Error("Buffer too large");t.push(198,c>>24,c>>16,c>>8,c),f=5}return e.push({_bin:n,_length:c,_offset:t.length}),f+c}if("function"==typeof n.toJSON)return p(t,e,n.toJSON());var l=[],v="",y=Object.keys(n);for(r=0,i=y.length;r<i;r++)void 0!==n[v=y[r]]&&"function"!=typeof n[v]&&l.push(v);if((c=l.length)<16)t.push(128|c),f=1;else if(c<65536)t.push(222,c>>8,c),f=3;else{if(!(c<4294967296))throw new Error("Object too large");t.push(223,c>>24,c>>16,c>>8,c),f=5}for(r=0;r<c;r++)f+=p(t,e,v=l[r]),f+=p(t,e,n[v]);return f}if("boolean"===o)return t.push(n?195:194),1;if("undefined"===o)return t.push(192),1;if("function"==typeof n.toJSON)return p(t,e,n.toJSON());throw new Error("Could not encode")}function l(t){var e=[],n=[],o=p(e,n,t),r=new ArrayBuffer(o),i=new DataView(r),s=0,a=0,c=-1;n.length>0&&(c=n[0]._offset);for(var f,h=0,u=0,l=0,v=e.length;l<v;l++)if(i.setUint8(a+l,e[l]),l+1===c){if(h=(f=n[s])._length,u=a+c,f._bin)for(var y=new Uint8Array(f._bin),g=0;g<h;g++)i.setUint8(u+g,y[g]);else f._str?d(i,u,f._str):void 0!==f._float&&i.setFloat64(u,f._float);a+=h,n[++s]&&(c=n[s]._offset)}return r}var v,y,g=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},m=function(){function t(t){this.events=t}return t.prototype.send=function(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)},t.prototype.connect=function(t){this.ws=new g(t,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},t.prototype.close=function(t,e){this.ws.close(t,e)},Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.ws.readyState===g.OPEN},enumerable:!1,configurable:!0}),t}(),w=function(){function t(){this.events={},this.transport=new m(this.events)}return t.prototype.send=function(t){this.transport.send(t)},t.prototype.connect=function(t){this.transport.connect(t)},t.prototype.close=function(t,e){this.transport.close(t,e)},Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.transport.isOpen},enumerable:!1,configurable:!0}),t}();function E(t,e){for(var n=t[e++],o="",r=0,i=e,s=e+n;i<s;i++){var a=t[i];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&t[++i])<<12|(63&t[++i])<<6|(63&t[++i])<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r)}else o+=String.fromCharCode((15&a)<<12|(63&t[++i])<<6|(63&t[++i])<<0);else o+=String.fromCharCode((31&a)<<6|63&t[++i]);else o+=String.fromCharCode(a)}return o}function A(t){void 0===t&&(t="");for(var e=0,n=0,o=0,r=t.length;o<r;o++)(e=t.charCodeAt(o))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(o++,n+=4);return n+1}t.Protocol=void 0,(v=t.Protocol||(t.Protocol={}))[v.HANDSHAKE=9]="HANDSHAKE",v[v.JOIN_ROOM=10]="JOIN_ROOM",v[v.ERROR=11]="ERROR",v[v.LEAVE_ROOM=12]="LEAVE_ROOM",v[v.ROOM_DATA=13]="ROOM_DATA",v[v.ROOM_STATE=14]="ROOM_STATE",v[v.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",v[v.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",v[v.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES",t.ErrorCode=void 0,(y=t.ErrorCode||(t.ErrorCode={}))[y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",y[y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",y[y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",y[y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",y[y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",y[y.AUTH_FAILED=4215]="AUTH_FAILED",y[y.APPLICATION_ERROR=4216]="APPLICATION_ERROR";var _={};function O(t,e){_[t]=e}function $(t){var e=_[t];if(!e)throw new Error("missing serializer: "+t);return e}var b=function(){function t(){this.handlers=[]}return t.prototype.register=function(t,e){return this.handlers.push(t),this},t.prototype.invoke=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.handlers.forEach((function(n){return n.apply(t,e)}))},t.prototype.invokeAsync=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Promise.all(this.handlers.map((function(n){return n.apply(t,e)})))},t.prototype.remove=function(t){var e=this.handlers.indexOf(t);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}();function I(){var t=new b;function e(e){return t.register(e,null===this)}return e.once=function(e){t.register((function n(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];e.apply(this,o),t.remove(n)}))},e.remove=function(e){return t.remove(e)},e.invoke=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.invoke.apply(t,e)},e.invokeAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.invokeAsync.apply(t,e)},e.clear=function(){return t.clear()},e}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var x=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t,e){!function(t){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}function o(t,e,n,o){var r,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,n,s):r(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function r(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var i,s=255,a=213;t.OPERATION=void 0,(i=t.OPERATION||(t.OPERATION={}))[i.ADD=128]="ADD",i[i.REPLACE=0]="REPLACE",i[i.DELETE=64]="DELETE",i[i.DELETE_AND_ADD=192]="DELETE_AND_ADD",i[i.TOUCH=1]="TOUCH",i[i.CLEAR=10]="CLEAR";var c=function(){function e(t,e,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(e,n)}return e.prototype.setParent=function(t,e,n){var o=this;if(this.indexes||(this.indexes=this.ref instanceof Rt?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=n,e)if(this.root=e,this.ref instanceof Rt){var r=this.ref._definition;for(var i in r.schema){var s=this.ref[i];if(s&&s.$changes){var a=r.indexes[i];s.$changes.setParent(this.ref,e,a)}}}else"object"==typeof this.ref&&this.ref.forEach((function(t,e){if(t instanceof Rt){var n=t.$changes,r=o.ref.$changes.indexes[e];n.setParent(o.ref,o.root,r)}}))},e.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},e.prototype.change=function(e,n){void 0===n&&(n=t.OPERATION.ADD);var o="number"==typeof e?e:this.indexes[e];this.assertValidIndex(o,e);var r=this.changes.get(o);r&&r.op!==t.OPERATION.DELETE&&r.op!==t.OPERATION.TOUCH||this.changes.set(o,{op:r&&r.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:n,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},e.prototype.touch=function(e){var n="number"==typeof e?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:t.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},e.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},e.prototype.getType=function(t){if(this.ref._definition)return(e=this.ref._definition).schema[e.fieldsByIndex[t]];var e,n=(e=this.parent._definition).schema[e.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},e.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},e.prototype.getValue=function(t){return this.ref.getByIndex(t)},e.prototype.delete=function(e){var n="number"==typeof e?e:this.indexes[e];if(void 0!==n){var o=this.getValue(n);this.changes.set(n,{op:t.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(e," (").concat(n,")"))},e.prototype.discard=function(e,n){var o=this;void 0===e&&(e=!1),void 0===n&&(n=!1),this.ref instanceof Rt||this.changes.forEach((function(e){if(e.op===t.OPERATION.DELETE){var n=o.ref.getIndex(e.index);delete o.indexes[n]}})),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},e.prototype.discardAll=function(){var t=this;this.changes.forEach((function(e){var n=t.getValue(e.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},e.prototype.cache=function(t,e){this.caches[t]=e},e.prototype.clone=function(){return new e(this.ref,this.parent,this.root)},e.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},e.prototype.assertValidIndex=function(t,e){if(void 0===t)throw new Error('ChangeTree: missing index for field "'.concat(e,'"'))},e}();function f(t,e,n,o){return t[e]||(t[e]=[]),t[e].push(n),null==o||o.forEach((function(t,e){return n(t,e)})),function(){return u(t[e],t[e].indexOf(n))}}function h(e){var n=this,o="string"!=typeof this.$changes.getType();this.$items.forEach((function(r,i){e.push({refId:n.$changes.refId,op:t.OPERATION.DELETE,field:i,value:void 0,previousValue:r}),o&&n.$changes.root.removeRef(r.$changes.refId)}))}function u(t,e){if(-1===e||e>=t.length)return!1;for(var n=t.length-1,o=e;o<n;o++)t[o]=t[o+1];return t.length=n,!0}var d=function(t,e){var n=t.toString(),o=e.toString();return n<o?-1:n>o?1:0};function p(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,e){return"symbol"==typeof e||isNaN(e)?t[e]:t.at(e)},set:function(t,e,n){if("symbol"==typeof e||isNaN(e))t[e]=n;else{var o=Array.from(t.$items.keys()),r=parseInt(o[e]||e);null==n?t.deleteAt(r):t.setAt(r,n)}return!0},deleteProperty:function(t,e){return"number"==typeof e?t.deleteAt(e):delete t[e],!0}})}var l=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return e.prototype.onAdd=function(e,n){return void 0===n&&(n=!0),f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,e,n?this.$items:void 0)},e.prototype.onRemove=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,e)},e.prototype.onChange=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,e)},e.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(e.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),e.prototype.push=function(){for(var t,e=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return n.forEach((function(n){t=e.$refId++,e.setAt(t,n)})),t},e.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var e=this.$items.get(t);return this.$items.delete(t),e}},e.prototype.at=function(t){var e=Array.from(this.$items.keys())[t];return this.$items.get(e)},e.prototype.setAt=function(e,n){var o,r;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,e);var i=null!==(r=null===(o=this.$changes.indexes[e])||void 0===o?void 0:o.op)&&void 0!==r?r:t.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,i)},e.prototype.deleteAt=function(t){var e=Array.from(this.$items.keys())[t];return void 0!==e&&this.$deleteAt(e)},e.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},e.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&h.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.concat=function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new(e.bind.apply(e,r([void 0],(t=Array.from(this.$items.values())).concat.apply(t,n),!1)))},e.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},e.prototype.reverse=function(){var t=this,e=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,o){t.setAt(e[o],n)})),this},e.prototype.shift=function(){var t=Array.from(this.$items.keys()).shift();if(void 0!==t){var e=this.$items.get(t);return this.$deleteAt(t),e}},e.prototype.slice=function(t,n){var o=new e;return o.push.apply(o,Array.from(this.$items.values()).slice(t,n)),o},e.prototype.sort=function(t){var e=this;void 0===t&&(t=d);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach((function(t,o){e.setAt(n[o],t)})),this},e.prototype.splice=function(t,e){void 0===e&&(e=this.length-t);for(var n=Array.from(this.$items.keys()),o=[],r=t;r<t+e;r++)o.push(this.$items.get(n[r])),this.$deleteAt(n[r]);return o},e.prototype.unshift=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=this.length,r=e.length,i=Array.from(this.$items.values());return e.forEach((function(e,n){t.setAt(n,e)})),i.forEach((function(e,n){t.setAt(r+n,e)})),o+r},e.prototype.indexOf=function(t,e){return Array.from(this.$items.values()).indexOf(t,e)},e.prototype.lastIndexOf=function(t,e){return void 0===e&&(e=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,e)},e.prototype.every=function(t,e){return Array.from(this.$items.values()).every(t,e)},e.prototype.some=function(t,e){return Array.from(this.$items.values()).some(t,e)},e.prototype.forEach=function(t,e){Array.from(this.$items.values()).forEach(t,e)},e.prototype.map=function(t,e){return Array.from(this.$items.values()).map(t,e)},e.prototype.filter=function(t,e){return Array.from(this.$items.values()).filter(t,e)},e.prototype.reduce=function(t,e){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},e.prototype.reduceRight=function(t,e){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},e.prototype.find=function(t,e){return Array.from(this.$items.values()).find(t,e)},e.prototype.findIndex=function(t,e){return Array.from(this.$items.values()).findIndex(t,e)},e.prototype.fill=function(t,e,n){throw new Error("ArraySchema#fill() not implemented")},e.prototype.copyWithin=function(t,e,n){throw new Error("ArraySchema#copyWithin() not implemented")},e.prototype.toString=function(){return this.$items.toString()},e.prototype.toLocaleString=function(){return this.$items.toLocaleString()},e.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},e.prototype.includes=function(t,e){return Array.from(this.$items.values()).includes(t,e)},e.prototype.flatMap=function(t,e){throw new Error("ArraySchema#flatMap() is not supported.")},e.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},e.prototype.findLast=function(){var t=Array.from(this.$items.values());return t.findLast.apply(t,arguments)},e.prototype.findLastIndex=function(){var t=Array.from(this.$items.values());return t.findLastIndex.apply(t,arguments)},e.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){return this.toArray().map((function(t){return"function"==typeof t.toJSON?t.toJSON():t}))},e.prototype.clone=function(t){return t?new(e.bind.apply(e,r([void 0],Array.from(this.$items.values()),!1))):new(e.bind.apply(e,r([void 0],this.map((function(t){return t.$changes?t.clone():t})),!1)))},e}();function v(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,e){return"symbol"!=typeof e&&void 0===t[e]?t.get(e):t[e]},set:function(t,e,n){return"symbol"!=typeof e&&-1===e.indexOf("$")&&"onAdd"!==e&&"onRemove"!==e&&"onChange"!==e?t.set(e,n):t[e]=n,!0},deleteProperty:function(t,e){return t.delete(e),!0}})}var y=function(){function e(t){var n=this;if(this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map||t instanceof e)t.forEach((function(t,e){return n.set(e,t)}));else for(var o in t)this.set(o,t[o])}return e.prototype.onAdd=function(e,n){return void 0===n&&(n=!0),f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,e,n?this.$items:void 0)},e.prototype.onRemove=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,e)},e.prototype.onChange=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,e)},e.is=function(t){return void 0!==t.map},e.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),e.prototype.set=function(e,n){if(null==n)throw new Error("MapSchema#set('".concat(e,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(e,"'."));var o=void 0!==this.$changes.indexes[e],r=o?this.$changes.indexes[e]:this.$refId++,i=o?t.OPERATION.REPLACE:t.OPERATION.ADD,s=void 0!==n.$changes;return s&&n.$changes.setParent(this,this.$changes.root,r),o?s&&this.$items.get(e)!==n&&(i=t.OPERATION.ADD):(this.$changes.indexes[e]=r,this.$indexes.set(r,e)),this.$items.set(e,n),this.$changes.change(e,i),this},e.prototype.get=function(t){return this.$items.get(t)},e.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},e.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&h.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return this.$items.has(t)},e.prototype.forEach=function(t){this.$items.forEach(t)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},e.prototype.toJSON=function(){var t={};return this.forEach((function(e,n){t[n]="function"==typeof e.toJSON?e.toJSON():e})),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach((function(t,e){t.$changes?n.set(e,t.clone()):n.set(e,t)}))),n},e}(),g={};function m(t,e){g[t]=e}function w(t){return g[t]}var E=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(t,e){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=t,this.indexes[t]=n,this.schema[t]=Array.isArray(e)?{array:e[0]}:e},t.prototype.hasField=function(t){return void 0!==this.indexes[t]},t.prototype.addFilter=function(t,e){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=e,this.indexesWithFilters.push(this.indexes[t]),!0},t.prototype.addChildrenFilter=function(t,e){var n=this.indexes[t],o=this.schema[t];if(w(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=e,!0;console.warn("@filterChildren: field '".concat(t,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function A(t){return t._context&&t._context.useFilters}var _=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,e){void 0===e&&(e=this.schemas.size),t._definition=E.create(t._definition),t._typeid=e,this.types[e]=t,this.schemas.set(t,e)},t.create=function(e){return void 0===e&&(e={}),function(n){return e.context||(e.context=new t),$(n,e)}},t}(),O=new _;function $(t,e){return void 0===e&&(e={}),function(n,o){var i=e.context||O,s=n.constructor;if(s._context=i,!t)throw new Error("".concat(s.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));i.has(s)||i.add(s);var a=s._definition;if(a.addField(o,t),a.descriptors[o]){if(a.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(s.name,"'.\nCheck @type() annotation"))}catch(t){var c=t.stack.split("\n")[4].trim();throw new Error("".concat(t.message," ").concat(c))}}var f=l.is(t),h=!f&&y.is(t);if("string"!=typeof t&&!Rt.is(t)){var u=Object.values(t)[0];"string"==typeof u||i.has(u)||i.add(u)}if(e.manual)a.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var d="_".concat(o);a.descriptors[d]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[o]={get:function(){return this[d]},set:function(t){t!==this[d]&&(null!=t?(!f||t instanceof l||(t=new(l.bind.apply(l,r([void 0],t,!1)))),!h||t instanceof y||(t=new y(t)),void 0===t.$proxy&&(h?t=v(t):f&&(t=p(t))),this.$changes.change(o),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[d]&&this.$changes.delete(o),this[d]=t)},enumerable:!0,configurable:!0}}}}function b(t){return function(e,n){var o=e.constructor;o._definition.addFilter(n,t)&&(o._context.useFilters=!0)}}function I(t){return function(e,n){var o=e.constructor;o._definition.addChildrenFilter(n,t)&&(o._context.useFilters=!0)}}function x(t){return void 0===t&&(t=!0),function(e,n){var o=e.constructor._definition;o.deprecated[n]=!0,t&&(o.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(t){},enumerable:!1,configurable:!0})}}function T(t,e,n){for(var o in void 0===n&&(n={}),n.context||(n.context=t._context||n.context||O),e)$(e[o],n)(t.prototype,o);return t}function R(t){for(var e=0,n=0,o=0,r=t.length;o<r;o++)(e=t.charCodeAt(o))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(o++,n+=4);return n}function C(t,e,n){for(var o=0,r=0,i=n.length;r<i;r++)(o=n.charCodeAt(r))<128?t[e++]=o:o<2048?(t[e++]=192|o>>6,t[e++]=128|63&o):o<55296||o>=57344?(t[e++]=224|o>>12,t[e++]=128|o>>6&63,t[e++]=128|63&o):(r++,o=65536+((1023&o)<<10|1023&n.charCodeAt(r)),t[e++]=240|o>>18,t[e++]=128|o>>12&63,t[e++]=128|o>>6&63,t[e++]=128|63&o)}function P(t,e){t.push(255&e)}function k(t,e){t.push(255&e)}function D(t,e){t.push(255&e),t.push(e>>8&255)}function S(t,e){t.push(255&e),t.push(e>>8&255)}function N(t,e){t.push(255&e),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function M(t,e){var n=e>>24,o=e>>16,r=e>>8,i=e;t.push(255&i),t.push(255&r),t.push(255&o),t.push(255&n)}function L(t,e){var n=Math.floor(e/Math.pow(2,32));M(t,e>>>0),M(t,n)}function j(t,e){var n=e/Math.pow(2,32)>>0;M(t,e>>>0),M(t,n)}function U(t,e){z(t,e)}function F(t,e){J(t,e)}var H=new Int32Array(2),B=new Float32Array(H.buffer),V=new Float64Array(H.buffer);function z(t,e){B[0]=e,N(t,H[0])}function J(t,e){V[0]=e,N(t,H[0]),N(t,H[1])}function W(t,e){return k(t,e?1:0)}function q(t,e){e||(e="");var n=R(e),o=0;if(n<32)t.push(160|n),o=1;else if(n<256)t.push(217),k(t,n),o=2;else if(n<65536)t.push(218),S(t,n),o=3;else{if(!(n<4294967296))throw new Error("String too long");t.push(219),M(t,n),o=5}return C(t,t.length,e),o+n}function K(t,e){return isNaN(e)?K(t,0):isFinite(e)?e!==(0|e)?(t.push(203),J(t,e),9):e>=0?e<128?(k(t,e),1):e<256?(t.push(204),k(t,e),2):e<65536?(t.push(205),S(t,e),3):e<4294967296?(t.push(206),M(t,e),5):(t.push(207),j(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),P(t,e),2):e>=-32768?(t.push(209),D(t,e),3):e>=-2147483648?(t.push(210),N(t,e),5):(t.push(211),L(t,e),9):K(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:C,int8:P,uint8:k,int16:D,uint16:S,int32:N,uint32:M,int64:L,uint64:j,float32:U,float64:F,writeFloat32:z,writeFloat64:J,boolean:W,string:q,number:K});function Y(t,e,n){for(var o="",r=0,i=e,s=e+n;i<s;i++){var a=t[i];0!=(128&a)?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(r=(7&a)<<18|(63&t[++i])<<12|(63&t[++i])<<6|(63&t[++i])<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r):o+=String.fromCharCode((15&a)<<12|(63&t[++i])<<6|(63&t[++i])<<0):o+=String.fromCharCode((31&a)<<6|63&t[++i]):o+=String.fromCharCode(a)}return o}function G(t,e){return Q(t,e)<<24>>24}function Q(t,e){return t[e.offset++]}function Z(t,e){return tt(t,e)<<16>>16}function tt(t,e){return t[e.offset++]|t[e.offset++]<<8}function et(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function nt(t,e){return et(t,e)>>>0}function ot(t,e){return ht(t,e)}function rt(t,e){return ut(t,e)}function it(t,e){var n=nt(t,e);return et(t,e)*Math.pow(2,32)+n}function st(t,e){var n=nt(t,e);return nt(t,e)*Math.pow(2,32)+n}var at=new Int32Array(2),ct=new Float32Array(at.buffer),ft=new Float64Array(at.buffer);function ht(t,e){return at[0]=et(t,e),ct[0]}function ut(t,e){return at[0]=et(t,e),at[1]=et(t,e),ft[0]}function dt(t,e){return Q(t,e)>0}function pt(t,e){var n,o=t[e.offset++];o<192?n=31&o:217===o?n=Q(t,e):218===o?n=tt(t,e):219===o&&(n=nt(t,e));var r=Y(t,e.offset,n);return e.offset+=n,r}function lt(t,e){var n=t[e.offset];return n<192&&n>160||217===n||218===n||219===n}function vt(t,e){var n=t[e.offset++];return n<128?n:202===n?ht(t,e):203===n?ut(t,e):204===n?Q(t,e):205===n?tt(t,e):206===n?nt(t,e):207===n?st(t,e):208===n?G(t,e):209===n?Z(t,e):210===n?et(t,e):211===n?it(t,e):n>223?-1*(255-n+1):void 0}function yt(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211}function gt(t,e){return t[e.offset]<160}function mt(t,e){return t[e.offset-1]===s&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var wt=Object.freeze({__proto__:null,int8:G,uint8:Q,int16:Z,uint16:tt,int32:et,uint32:nt,float32:ot,float64:rt,int64:it,uint64:st,readFloat32:ht,readFloat64:ut,boolean:dt,string:pt,stringCheck:lt,number:vt,numberCheck:yt,arrayCheck:gt,switchStructureCheck:mt}),Et=function(){function e(t){var e=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return e.add(t)}))}return e.prototype.onAdd=function(e,n){return void 0===n&&(n=!0),f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,e,n?this.$items:void 0)},e.prototype.onRemove=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,e)},e.prototype.onChange=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,e)},e.is=function(t){return void 0!==t.collection},e.prototype.add=function(t){var e=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,e),this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,t),this.$changes.change(e),e},e.prototype.at=function(t){var e=Array.from(this.$items.keys())[t];return this.$items.get(e)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var e,n,o=this.$items.entries();(n=o.next())&&!n.done;)if(t===n.value[1]){e=n.value[0];break}return void 0!==e&&(this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e))},e.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&h.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return Array.from(this.$items.values()).some((function(e){return e===t}))},e.prototype.forEach=function(t){var e=this;this.$items.forEach((function(n,o,r){return t(n,o,e)}))},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach((function(e,n){t.push("function"==typeof e.toJSON?e.toJSON():e)})),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach((function(t){t.$changes?n.add(t.clone()):n.add(t)}))),n},e}(),At=function(){function e(t){var e=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return e.add(t)}))}return e.prototype.onAdd=function(e,n){return void 0===n&&(n=!0),f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,e,n?this.$items:void 0)},e.prototype.onRemove=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,e)},e.prototype.onChange=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,e)},e.is=function(t){return void 0!==t.set},e.prototype.add=function(e){var n,o;if(this.has(e))return!1;var r=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,r);var i=null!==(o=null===(n=this.$changes.indexes[r])||void 0===n?void 0:n.op)&&void 0!==o?o:t.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,e),this.$changes.change(r,i),r},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var e,n,o=this.$items.entries();(n=o.next())&&!n.done;)if(t===n.value[1]){e=n.value[0];break}return void 0!==e&&(this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e))},e.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&h.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){for(var e,n=this.$items.values(),o=!1;(e=n.next())&&!e.done;)if(t===e.value){o=!0;break}return o},e.prototype.forEach=function(t){var e=this;this.$items.forEach((function(n,o,r){return t(n,o,e)}))},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,e){this.$indexes.set(t,e)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var e=this.$indexes.get(t);this.$items.delete(e),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach((function(e,n){t.push("function"==typeof e.toJSON?e.toJSON():e)})),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach((function(t){t.$changes?n.add(t.clone()):n.add(t)}))),n},e}(),_t=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},t.get=function(e){return void 0===e.$filterState&&(e.$filterState=new t),e.$filterState},t}(),Ot=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,e,n){void 0===n&&(n=!0),this.refs.set(t,e),n&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach((function(e){if(!(t.refCounts[e]>0)){var n=t.refs.get(e);if(n instanceof Rt)for(var o in n._definition.schema)"string"!=typeof n._definition.schema[o]&&n[o]&&n[o].$changes&&t.removeRef(n[o].$changes.refId);else{var r=n.$changes.parent._definition,i=r.schema[r.fieldsByIndex[n.$changes.parentIndex]];"function"==typeof Object.values(i)[0]&&Array.from(n.values()).forEach((function(e){return t.removeRef(e.$changes.refId)}))}t.refs.delete(e),delete t.refCounts[e]}})),this.deletedRefs.clear()},t}(),$t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(Error);function bt(t,e,n,o){var r,i=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(o));break;case"string":r="string",i=!0;break;case"boolean":return}if(typeof t!==r&&(!i||i&&null!==t)){var s="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new $t("a '".concat(r,"' was expected, but ").concat(s," was provided in ").concat(n.constructor.name,"#").concat(o))}}function It(t,e,n,o){if(!(t instanceof e))throw new $t("a '".concat(e.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(o))}function xt(t,e,n,o,r){bt(n,t,o,r);var i=X[t];if(!i)throw new $t("a '".concat(t,"' was expected, but ").concat(n," was provided in ").concat(o.constructor.name,"#").concat(r));i(e,n)}function Tt(t,e,n){return wt[t](e,n)}var Rt=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Object.defineProperties(this,{$changes:{value:new c(this,void 0,new Ot),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),t[0]&&this.assign(t[0])}return e.onError=function(t){console.error(t)},e.is=function(t){return t._definition&&void 0!==t._definition.schema},e.prototype.onChange=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,e)},e.prototype.onRemove=function(e){return f(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,e)},e.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(e.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),e.prototype.setDirty=function(t,e){this.$changes.change(t,e)},e.prototype.listen=function(t,e,n){var o=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[t]||(this.$callbacks[t]=[]),this.$callbacks[t].push(e),n&&void 0!==this[t]&&e(this[t],void 0),function(){return u(o.$callbacks[t],o.$callbacks[t].indexOf(e))}},e.prototype.decode=function(n,o,r){var i;void 0===o&&(o={offset:0}),void 0===r&&(r=this);var a=[],c=this.$changes.root,f=n.length,h=0;for(c.refs.set(h,this);o.offset<f;){var u=n[o.offset++];if(u!=s){var d=r.$changes,p=void 0!==r._definition,v=p?u>>6<<6:u;if(v!==t.OPERATION.CLEAR){var g=p?u%(v||255):vt(n,o),m=p?r._definition.fieldsByIndex[g]:"",E=d.getType(g),A=void 0,_=void 0,O=void 0;if(p?_=r["_".concat(m)]:(_=r.getByIndex(g),(v&t.OPERATION.ADD)===t.OPERATION.ADD?(O=r instanceof y?pt(n,o):g,r.setIndex(g,O)):O=r.getIndex(g)),(v&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(v!==t.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(g),_&&_.$changes&&c.removeRef(_.$changes.refId),A=null),void 0!==m){if(v===t.OPERATION.DELETE);else if(e.is(E)){var $=vt(n,o);if(A=c.refs.get($),v!==t.OPERATION.REPLACE){var b=this.getSchemaType(n,o,E);A||((A=this.createTypeInstance(b)).$changes.refId=$,_&&(A.$callbacks=_.$callbacks,_.$changes.refId&&$!==_.$changes.refId&&c.removeRef(_.$changes.refId))),c.addRef($,A,A!==_)}}else if("string"==typeof E)A=Tt(E,n,o);else{var I=w(Object.keys(E)[0]),x=vt(n,o),T=c.refs.has(x)?_||c.refs.get(x):new I.constructor;if((A=T.clone(!0)).$changes.refId=x,_&&(A.$callbacks=_.$callbacks,_.$changes.refId&&x!==_.$changes.refId)){c.removeRef(_.$changes.refId);for(var R=_.entries(),C=void 0;(C=R.next())&&!C.done;){var P=(i=C.value)[0],k=i[1];a.push({refId:x,op:t.OPERATION.DELETE,field:P,value:void 0,previousValue:k})}}c.addRef(x,A,T!==_)}if(null!=A)if(A.$changes&&A.$changes.setParent(d.ref,d.root,g),r instanceof e)r[m]=A;else if(r instanceof y)P=O,r.$items.set(P,A),r.$changes.allChanges.add(g);else if(r instanceof l)r.setAt(g,A);else if(r instanceof Et){var D=r.add(A);r.setIndex(g,D)}else r instanceof At&&!1!==(D=r.add(A))&&r.setIndex(g,D);_!==A&&a.push({refId:h,op:v,field:m,dynamicIndex:O,value:A,previousValue:_})}else{console.warn("@colyseus/schema: definition mismatch");for(var S={offset:o.offset};o.offset<f&&(!mt(n,o)||(S.offset=o.offset+1,!c.refs.has(vt(n,S))));)o.offset++}}else r.clear(a)}else{h=vt(n,o);var N=c.refs.get(h);if(!N)throw new Error('"refId" not found: '.concat(h));r=N}}return this._triggerChanges(a),c.garbageCollectDeletedRefs(),a},e.prototype.encode=function(n,o,r){void 0===n&&(n=!1),void 0===o&&(o=[]),void 0===r&&(r=!1);for(var i=this.$changes,a=new WeakSet,c=[i],f=1,h=0;h<f;h++){var u=c[h],d=u.ref,p=d instanceof e;u.ensureRefId(),a.add(u),u!==i&&(u.changed||n)&&(k(o,s),K(o,u.refId));for(var l=n?Array.from(u.allChanges):Array.from(u.changes.values()),v=0,g=l.length;v<g;v++){var m=n?{op:t.OPERATION.ADD,index:l[v]}:l[v],E=m.index,A=p?d._definition.fieldsByIndex&&d._definition.fieldsByIndex[E]:E,_=o.length;if(m.op!==t.OPERATION.TOUCH)if(p)k(o,E|m.op);else{if(k(o,m.op),m.op===t.OPERATION.CLEAR)continue;K(o,E)}if(p||(m.op&t.OPERATION.ADD)!=t.OPERATION.ADD||d instanceof y&&q(o,u.ref.$indexes.get(E)),m.op!==t.OPERATION.DELETE){var O=u.getType(E),$=u.getValue(E);if($&&$.$changes&&!a.has($.$changes)&&(c.push($.$changes),$.$changes.ensureRefId(),f++),m.op!==t.OPERATION.TOUCH){if(e.is(O))It($,O,d,A),K(o,$.$changes.refId),(m.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(o,O,$.constructor);else if("string"==typeof O)xt(O,o,$,d,A);else{var b=w(Object.keys(O)[0]);It(d["_".concat(A)],b.constructor,d,A),K(o,$.$changes.refId)}r&&u.cache(E,o.slice(_))}}}n||r||u.discard()}return o},e.prototype.encodeAll=function(t){return this.encode(!0,[],t)},e.prototype.applyFilters=function(n,o){var r,i;void 0===o&&(o=!1);for(var a=this,c=new Set,f=_t.get(n),h=[this.$changes],u=1,d=[],p=function(p){var l=h[p];if(c.has(l.refId))return"continue";var v=l.ref,g=v instanceof e;k(d,s),K(d,l.refId);var m=f.refIds.has(l),w=o||!m;f.addRefId(l);var E=f.containerIndexes.get(l),A=w?Array.from(l.allChanges):Array.from(l.changes.values());!o&&g&&v._definition.indexesWithFilters&&v._definition.indexesWithFilters.forEach((function(e){!E.has(e)&&l.allChanges.has(e)&&(w?A.push(e):A.push({op:t.OPERATION.ADD,index:e}))}));for(var _=0,O=A.length;_<O;_++){var $=w?{op:t.OPERATION.ADD,index:A[_]}:A[_];if($.op!==t.OPERATION.CLEAR){var b=$.index;if($.op!==t.OPERATION.DELETE){var I=l.getValue(b),x=l.getType(b);if(g){if((T=v._definition.filters&&v._definition.filters[b])&&!T.call(v,n,I,a)){I&&I.$changes&&c.add(I.$changes.refId);continue}}else{var T,R=l.parent;if((T=l.getChildrenFilter())&&!T.call(R,n,v.$indexes.get(b),I,a)){I&&I.$changes&&c.add(I.$changes.refId);continue}}if(I.$changes&&(h.push(I.$changes),u++),$.op!==t.OPERATION.TOUCH)if($.op===t.OPERATION.ADD||g)d.push.apply(d,null!==(r=l.caches[b])&&void 0!==r?r:[]),E.add(b);else if(E.has(b))d.push.apply(d,null!==(i=l.caches[b])&&void 0!==i?i:[]);else{if(E.add(b),k(d,t.OPERATION.ADD),K(d,b),v instanceof y){var C=l.ref.$indexes.get(b);q(d,C)}I.$changes?K(d,I.$changes.refId):X[x](d,I)}else I.$changes&&!g&&(k(d,t.OPERATION.ADD),K(d,b),v instanceof y&&(C=l.ref.$indexes.get(b),q(d,C)),K(d,I.$changes.refId))}else g?k(d,$.op|b):(k(d,$.op),K(d,b))}else k(d,$.op)}},l=0;l<u;l++)p(l);return d},e.prototype.clone=function(){var t,e=new this.constructor,n=this._definition.schema;for(var o in n)"object"==typeof this[o]&&"function"==typeof(null===(t=this[o])||void 0===t?void 0:t.clone)?e[o]=this[o].clone():e[o]=this[o];return e},e.prototype.toJSON=function(){var t=this._definition.schema,e=this._definition.deprecated,n={};for(var o in t)e[o]||null===this[o]||void 0===this[o]||(n[o]="function"==typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return n},e.prototype.discardAllChanges=function(){this.$changes.discardAll()},e.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},e.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},e.prototype.tryEncodeTypeId=function(t,e,n){e._typeid!==n._typeid&&(k(t,a),K(t,n._typeid))},e.prototype.getSchemaType=function(t,e,n){var o;return t[e.offset]===a&&(e.offset++,o=this.constructor._context.get(vt(t,e))),o||n},e.prototype.createTypeInstance=function(t){var e=new t;return e.$changes.root=this.$changes.root,e},e.prototype._triggerChanges=function(n){for(var o,r,i,s,a,c,f,h,u,d=new Set,p=this.$changes.root.refs,l=function(l){var v=n[l],y=v.refId,g=p.get(y),m=g.$callbacks;if((v.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&v.previousValue instanceof e&&(null===(r=null===(o=v.previousValue.$callbacks)||void 0===o?void 0:o[t.OPERATION.DELETE])||void 0===r||r.forEach((function(t){return t()}))),!m)return"continue";if(g instanceof e){if(!d.has(y))try{null===(i=null==m?void 0:m[t.OPERATION.REPLACE])||void 0===i||i.forEach((function(t){return t(n)}))}catch(t){e.onError(t)}try{m.hasOwnProperty(v.field)&&(null===(s=m[v.field])||void 0===s||s.forEach((function(t){return t(v.value,v.previousValue)})))}catch(t){e.onError(t)}}else v.op===t.OPERATION.ADD&&void 0===v.previousValue?null===(a=m[t.OPERATION.ADD])||void 0===a||a.forEach((function(t){var e;return t(v.value,null!==(e=v.dynamicIndex)&&void 0!==e?e:v.field)})):v.op===t.OPERATION.DELETE?void 0!==v.previousValue&&(null===(c=m[t.OPERATION.DELETE])||void 0===c||c.forEach((function(t){var e;return t(v.previousValue,null!==(e=v.dynamicIndex)&&void 0!==e?e:v.field)}))):v.op===t.OPERATION.DELETE_AND_ADD&&(void 0!==v.previousValue&&(null===(f=m[t.OPERATION.DELETE])||void 0===f||f.forEach((function(t){var e;return t(v.previousValue,null!==(e=v.dynamicIndex)&&void 0!==e?e:v.field)}))),null===(h=m[t.OPERATION.ADD])||void 0===h||h.forEach((function(t){var e;return t(v.value,null!==(e=v.dynamicIndex)&&void 0!==e?e:v.field)}))),v.value!==v.previousValue&&(null===(u=m[t.OPERATION.REPLACE])||void 0===u||u.forEach((function(t){var e;return t(v.value,null!==(e=v.dynamicIndex)&&void 0!==e?e:v.field)})));d.add(y)},v=0;v<n.length;v++)l(v)},e._definition=E.create(),e}();function Ct(t){for(var e=[t.$changes],n=1,o={},r=o,i=function(t){var n=e[t];n.changes.forEach((function(t){var e=n.ref,o=t.index,i=e._definition?e._definition.fieldsByIndex[o]:e.$indexes.get(o);r[i]=n.getValue(o)}))},s=0;s<n;s++)i(s);return o}var Pt={context:new _},kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),o([$("string",Pt)],e.prototype,"name",void 0),o([$("string",Pt)],e.prototype,"type",void 0),o([$("number",Pt)],e.prototype,"referencedType",void 0),e}(Rt),Dt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=new l,e}return n(e,t),o([$("number",Pt)],e.prototype,"id",void 0),o([$([kt],Pt)],e.prototype,"fields",void 0),e}(Rt),St=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.types=new l,e}return n(e,t),e.encode=function(t){var n=t.constructor,o=new e;o.rootType=n._typeid;var r=function(t,e){for(var n in e){var r=new kt;r.name=n;var i=void 0;if("string"==typeof e[n])i=e[n];else{var s=e[n],a=void 0;Rt.is(s)?(i="ref",a=e[n]):"string"==typeof s[i=Object.keys(s)[0]]?i+=":"+s[i]:a=s[i],r.referencedType=a?a._typeid:-1}r.type=i,t.fields.push(r)}o.types.push(t)},i=n._context.types;for(var s in i){var a=new Dt;a.id=Number(s),r(a,i[s]._definition.schema)}return o.encodeAll()},e.decode=function(t,o){var r=new _,i=new e;i.decode(t,o);var s=i.types.reduce((function(t,e){var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(Rt),i=e.id;return t[i]=o,r.add(o,i),t}),{});i.types.forEach((function(t){var e=s[t.id];t.fields.forEach((function(t){var n;if(void 0!==t.referencedType){var o=t.type,i=s[t.referencedType];if(!i){var a=t.type.split(":");o=a[0],i=a[1]}"ref"===o?$(i,{context:r})(e.prototype,t.name):$(((n={})[o]=i,n),{context:r})(e.prototype,t.name)}else $(t.type,{context:r})(e.prototype,t.name)}))}));var a=s[i.rootType],c=new a;for(var f in a._definition.schema){var h=a._definition.schema[f];"string"!=typeof h&&(c[f]="function"==typeof h?new h:new(w(Object.keys(h)[0]).constructor))}return c},o([$([Dt],Pt)],e.prototype,"types",void 0),o([$("number",Pt)],e.prototype,"rootType",void 0),e}(Rt);m("map",{constructor:y}),m("array",{constructor:l}),m("set",{constructor:At}),m("collection",{constructor:Et}),t.ArraySchema=l,t.CollectionSchema=Et,t.Context=_,t.MapSchema=y,t.Reflection=St,t.ReflectionField=kt,t.ReflectionType=Dt,t.Schema=Rt,t.SchemaDefinition=E,t.SetSchema=At,t.decode=wt,t.defineTypes=T,t.deprecated=x,t.dumpChanges=Ct,t.encode=X,t.filter=b,t.filterChildren=I,t.hasFilter=A,t.registerType=m,t.type=$,Object.defineProperty(t,"__esModule",{value:!0})}(e)})),T=function(){function e(t,e){var n=this;this.onStateChange=I(),this.onError=I(),this.onLeave=I(),this.onJoin=I(),this.hasJoined=!1,this.onMessageHandlers={emit:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var o=this.events[t]||[],r=0,i=o.length;r<i;r++)o[r].apply(o,e)},events:{},on:function(t,e){var n,o=this;return(null===(n=this.events[t])||void 0===n?void 0:n.push(e))||(this.events[t]=[e]),function(){var n;o.events[t]=null===(n=o.events[t])||void 0===n?void 0:n.filter((function(t){return e!==t}))}}},this.roomId=null,this.name=t,e&&(this.serializer=new($("schema")),this.rootSchema=e,this.serializer.state=new e),this.onError((function(t,e){var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,"colyseus.js - onError => (".concat(t,") ").concat(e))})),this.onLeave((function(){return n.removeAllListeners()}))}return Object.defineProperty(e.prototype,"id",{get:function(){return this.roomId},enumerable:!1,configurable:!0}),e.prototype.connect=function(t,n,o){void 0===o&&(o=this);var i=new w;o.connection=i,i.events.onmessage=e.prototype.onMessageCallback.bind(o),i.events.onclose=function(t){var e;if(!o.hasJoined)return null===(e=console.warn)||void 0===e||e.call(console,"Room connection was closed unexpectedly (".concat(t.code,"): ").concat(t.reason)),void o.onError.invoke(t.code,t.reason);t.code===r.DEVMODE_RESTART&&n?n():(o.onLeave.invoke(t.code),o.destroy())},i.events.onerror=function(t){var e;null===(e=console.warn)||void 0===e||e.call(console,"Room, onError (".concat(t.code,"): ").concat(t.reason)),o.onError.invoke(t.code,t.reason)},i.connect(t)},e.prototype.leave=function(e){var n=this;return void 0===e&&(e=!0),new Promise((function(o){n.onLeave((function(t){return o(t)})),n.connection?e?n.connection.send([t.Protocol.LEAVE_ROOM]):n.connection.close():n.onLeave.invoke(r.CONSENTED)}))},e.prototype.onMessage=function(t,e){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),e)},e.prototype.send=function(e,n){var o,r=[t.Protocol.ROOM_DATA];if("string"==typeof e?x.encode.string(r,e):x.encode.number(r,e),void 0!==n){var i=l(n);(o=new Uint8Array(r.length+i.byteLength)).set(new Uint8Array(r),0),o.set(new Uint8Array(i),r.length)}else o=new Uint8Array(r);this.connection.send(o.buffer)},e.prototype.sendBytes=function(e,n){var o,r=[t.Protocol.ROOM_DATA_BYTES];"string"==typeof e?x.encode.string(r,e):x.encode.number(r,e),(o=new Uint8Array(r.length+(n.byteLength||n.length))).set(new Uint8Array(r),0),o.set(new Uint8Array(n),r.length),this.connection.send(o.buffer)},Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),e.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},e.prototype.onMessageCallback=function(e){var n=Array.from(new Uint8Array(e.data)),o=n[0];if(o===t.Protocol.JOIN_ROOM){var r=1,i=E(n,r);if(r+=A(i),this.serializerId=E(n,r),r+=A(this.serializerId),!this.serializer){var s=$(this.serializerId);this.serializer=new s}n.length>r&&this.serializer.handshake&&this.serializer.handshake(n,{offset:r}),this.reconnectionToken="".concat(this.roomId,":").concat(i),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([t.Protocol.JOIN_ROOM])}else if(o===t.Protocol.ERROR){var a={offset:1},c=x.decode.number(n,a),f=x.decode.string(n,a);this.onError.invoke(c,f)}else if(o===t.Protocol.LEAVE_ROOM)this.leave();else if(o===t.Protocol.ROOM_DATA_SCHEMA){var h={offset:1};(f=new(p=this.serializer.getState().constructor._context.get(x.decode.number(n,h)))).decode(n,h),this.dispatchMessage(p,f)}else if(o===t.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(o===t.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(o===t.Protocol.ROOM_DATA){var d={offset:1},p=x.decode.stringCheck(n,d)?x.decode.string(n,d):x.decode.number(n,d);f=n.length>d.offset?function(t,e){void 0===e&&(e=0);var n=new u(t,e),o=n._parse();if(n._offset!==t.byteLength)throw new Error(t.byteLength-n._offset+" trailing bytes");return o}(e.data,d.offset):void 0;this.dispatchMessage(p,f)}else if(o===t.Protocol.ROOM_DATA_BYTES){var l={offset:1};p=x.decode.stringCheck(n,l)?x.decode.string(n,l):x.decode.number(n,l);this.dispatchMessage(p,new Uint8Array(n.slice(l.offset)))}},e.prototype.setState=function(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())},e.prototype.patch=function(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())},e.prototype.dispatchMessage=function(t,e){var n,o=this.getMessageHandlerKey(t);this.onMessageHandlers.events[o]?this.onMessageHandlers.emit(o,e):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,e):null===(n=console.warn)||void 0===n||n.call(console,"colyseus.js: onMessage() not registered for type '".concat(t,"'."))},e.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},e.prototype.getMessageHandlerKey=function(t){switch(typeof t){case"function":return"$".concat(t._typeid);case"string":return t;case"number":return"i".concat(t);default:throw new Error("invalid message type.")}},e}();function R(t,e){e.headers=t.headers||{},e.statusMessage=t.statusText,e.statusCode=t.status,e.data=t.response}function C(t,e,n){return new Promise((function(o,r){n=n||{};var i,s,a,c=new XMLHttpRequest,f=n.body,h=n.headers||{};for(i in n.timeout&&(c.timeout=n.timeout),c.ontimeout=c.onerror=function(t){t.timeout="timeout"==t.type,r(t)},c.open(t,e.href||e),c.onload=function(){for(a=c.getAllResponseHeaders().trim().split(/[\r\n]+/),R(c,c);s=a.shift();)s=s.split(": "),c.headers[s.shift().toLowerCase()]=s.join(": ");if((s=c.headers["content-type"])&&~s.indexOf("application/json"))try{c.data=JSON.parse(c.data,n.reviver)}catch(t){return R(c,t),r(t)}(c.status>=400?r:o)(c)},typeof FormData<"u"&&f instanceof FormData||f&&"object"==typeof f&&(h["content-type"]="application/json",f=JSON.stringify(f)),c.withCredentials=!!n.withCredentials,h)c.setRequestHeader(i,h[i]);c.send(f)}))}var P,k,D,S,N,M=C.bind(C,"GET"),L=C.bind(C,"POST"),j=C.bind(C,"PATCH"),U=C.bind(C,"DELETE"),F=C.bind(C,"PUT"),H={del:U,get:M,patch:j,post:L,put:F,send:C},B=e({__proto__:null,default:H,del:U,get:M,patch:j,post:L,put:F,send:C},[H]),V=function(){function t(t){this.client=t}return t.prototype.get=function(t,e){return void 0===e&&(e={}),this.request("get",t,e)},t.prototype.post=function(t,e){return void 0===e&&(e={}),this.request("post",t,e)},t.prototype.del=function(t,e){return void 0===e&&(e={}),this.request("del",t,e)},t.prototype.put=function(t,e){return void 0===e&&(e={}),this.request("put",t,e)},t.prototype.request=function(t,e,n){return void 0===n&&(n={}),B[t](this.client.getHttpEndpoint(e),this.getOptions(n)).catch((function(t){var e;throw new h(t.statusCode||-1,(null===(e=t.data)||void 0===e?void 0:e.error)||t.statusMessage||t.message||"offline")}))},t.prototype.getOptions=function(t){return this.authToken&&(t.headers||(t.headers={}),t.headers.Authorization="Bearer ".concat(this.authToken),t.withCredentials=!0),t},t}();function z(){return P||(P="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(t,e){this.cache[t]=e},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),P}var J,W=function(){function t(t){var e,n,o,r=this;this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},k.set(this,!1),D.set(this,void 0),S.set(this,void 0),N.set(this,{emit:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var o=this.events[t]||[],r=0,i=o.length;r<i;r++)o[r].apply(o,e)},events:{},on:function(t,e){var n,o=this;return(null===(n=this.events[t])||void 0===n?void 0:n.push(e))||(this.events[t]=[e]),function(){var n;o.events[t]=null===(n=o.events[t])||void 0===n?void 0:n.filter((function(t){return e!==t}))}}}),e=this.settings.key,n=function(t){return r.token=t},o=z().getItem(e),"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(t){return n(t)})):n(o)}return Object.defineProperty(t.prototype,"token",{get:function(){return this.http.authToken},set:function(t){this.http.authToken=t},enumerable:!1,configurable:!0}),t.prototype.onChange=function(t){var e=this,n=c(this,N,"f").on("change",t);return c(this,k,"f")||f(this,D,new Promise((function(t,n){e.getUserData().then((function(t){e.emitChange(i(i({},t),{token:e.token}))})).catch((function(t){e.emitChange({user:null,token:void 0})})).finally((function(){t()}))})),"f"),f(this,k,!0,"f"),n},t.prototype.getUserData=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.token?[4,this.http.get("".concat(this.settings.path,"/userdata"))]:[3,2];case 1:return[2,t.sent().data];case 2:throw new Error("missing auth.token")}}))}))},t.prototype.registerWithEmailAndPassword=function(t,e,n){return s(this,void 0,void 0,(function(){var o;return a(this,(function(r){switch(r.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/register"),{body:{email:t,password:e,options:n}})];case 1:return o=r.sent().data,this.emitChange(o),[2,o]}}))}))},t.prototype.signInWithEmailAndPassword=function(t,e){return s(this,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/login"),{body:{email:t,password:e}})];case 1:return n=o.sent().data,this.emitChange(n),[2,n]}}))}))},t.prototype.signInAnonymously=function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:t}})];case 1:return e=n.sent().data,this.emitChange(e),[2,e]}}))}))},t.prototype.sendPasswordResetEmail=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:t}})];case 1:return[2,e.sent().data]}}))}))},t.prototype.signInWithProvider=function(t,e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var n=this;return a(this,(function(o){return[2,new Promise((function(o,r){var i=e.width||480,s=e.height||768,a=n.token?"?token=".concat(n.token):"",h="Login with ".concat(t[0].toUpperCase()+t.substring(1)),u=n.http.client.getHttpEndpoint("".concat(e.prefix||"".concat(n.settings.path,"/provider"),"/").concat(t).concat(a)),d=screen.width/2-i/2,p=screen.height/2-s/2;f(n,S,window.open(u,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+i+", height="+s+", top="+p+", left="+d),"f");var l=function t(e){void 0===e.data.user&&void 0===e.data.token||(clearInterval(v),c(n,S,"f").close(),f(n,S,void 0,"f"),window.removeEventListener("message",t),void 0!==e.data.error?r(e.data.error):(o(e.data),n.emitChange(e.data)))},v=setInterval((function(){c(n,S,"f")&&!c(n,S,"f").closed||(f(n,S,void 0,"f"),r("cancelled"),window.removeEventListener("message",l))}),200);window.addEventListener("message",l)}))]}))}))},t.prototype.signOut=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return this.emitChange({user:null,token:null}),[2]}))}))},t.prototype.emitChange=function(t){var e;void 0!==t.token&&(this.token=t.token,null===t.token?(e=this.settings.key,z().removeItem(e)):function(t,e){z().setItem(t,e)}(this.settings.key,t.token)),c(this,N,"f").emit("change",t)},t}();k=new WeakMap,D=new WeakMap,S=new WeakMap,N=new WeakMap;var q=function(t){function e(n,o){var r=t.call(this,n)||this;return r.code=o,Object.setPrototypeOf(r,e.prototype),r}return o(e,t),e}(Error),K="undefined"!=typeof window&&void 0!==(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",X=function(){function t(t){if(void 0===t&&(t=K),"string"==typeof t){var e=new URL(t),n="https:"===e.protocol||"wss:"===e.protocol,o=Number(e.port||(n?443:80));this.settings={hostname:e.hostname,pathname:e.pathname,port:o,secure:n}}else void 0===t.port&&(t.port=t.secure?443:80),void 0===t.pathname&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new V(this),this.auth=new W(this.http)}return t.prototype.joinOrCreate=function(t,e,n){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",t,e,n)];case 1:return[2,o.sent()]}}))}))},t.prototype.create=function(t,e,n){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("create",t,e,n)];case 1:return[2,o.sent()]}}))}))},t.prototype.join=function(t,e,n){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("join",t,e,n)];case 1:return[2,o.sent()]}}))}))},t.prototype.joinById=function(t,e,n){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){return a(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("joinById",t,e,n)];case 1:return[2,o.sent()]}}))}))},t.prototype.reconnect=function(t,e){return s(this,void 0,void 0,(function(){var n,o,r;return a(this,(function(i){switch(i.label){case 0:if("string"==typeof t&&"string"==typeof e)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");if(n=t.split(":"),o=n[0],r=n[1],!o||!r)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return[4,this.createMatchMakeRequest("reconnect",o,{reconnectionToken:r},e)];case 1:return[2,i.sent()]}}))}))},t.prototype.getAvailableRooms=function(t){return void 0===t&&(t=""),s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.http.get("matchmake/".concat(t),{headers:{Accept:"application/json"}})];case 1:return[2,e.sent().data]}}))}))},t.prototype.consumeSeatReservation=function(t,e,n){return s(this,void 0,void 0,(function(){var o,r,i,c=this;return a(this,(function(f){return(o=this.createRoom(t.room.name,e)).roomId=t.room.roomId,o.sessionId=t.sessionId,r={sessionId:o.sessionId},t.reconnectionToken&&(r.reconnectionToken=t.reconnectionToken),i=n||o,o.connect(this.buildEndpoint(t.room,r),t.devMode&&function(){return s(c,void 0,void 0,(function(){var n,r,c=this;return a(this,(function(f){return console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(o.roomId,"'...")),n=0,8,r=function(){return s(c,void 0,void 0,(function(){return a(this,(function(s){switch(s.label){case 0:n++,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.consumeSeatReservation(t,e,i)];case 2:return s.sent(),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(o.roomId,"'")),[3,4];case 3:return s.sent(),n<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(n," out of ").concat(8,")")),setTimeout(r,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs.")),[3,4];case 4:return[2]}}))}))},setTimeout(r,2e3),[2]}))}))},i),[2,new Promise((function(t,e){var n=function(t,n){return e(new h(t,n))};i.onError.once(n),i.onJoin.once((function(){i.onError.remove(n),t(i)}))}))]}))}))},t.prototype.createMatchMakeRequest=function(t,e,n,o,r){return void 0===n&&(n={}),s(this,void 0,void 0,(function(){var i;return a(this,(function(s){switch(s.label){case 0:return[4,this.http.post("matchmake/".concat(t,"/").concat(e),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((i=s.sent().data).error)throw new q(i.error,i.code);return"reconnect"===t&&(i.reconnectionToken=n.reconnectionToken),[4,this.consumeSeatReservation(i,o,r)];case 2:return[2,s.sent()]}}))}))},t.prototype.createRoom=function(t,e){return new T(t,e)},t.prototype.buildEndpoint=function(t,e){void 0===e&&(e={});var n=[];for(var o in e)e.hasOwnProperty(o)&&n.push("".concat(o,"=").concat(e[o]));var r=this.settings.secure?"wss://":"ws://";return t.publicAddress?r+="".concat(t.publicAddress):r+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(r,"/").concat(t.processId,"/").concat(t.roomId,"?").concat(n.join("&"))},t.prototype.getHttpEndpoint=function(t){void 0===t&&(t="");var e=t.startsWith("/")?t:"/".concat(t);return"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(e)},t.prototype.getEndpointPort=function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""},t}(),Y=function(){function t(){}return t.prototype.setState=function(t){return this.state.decode(t)},t.prototype.getState=function(){return this.state},t.prototype.patch=function(t){return this.state.decode(t)},t.prototype.teardown=function(){var t,e;null===(e=null===(t=this.state)||void 0===t?void 0:t.$changes)||void 0===e||e.root.clearRefs()},t.prototype.handshake=function(t,e){this.state?(new x.Reflection).decode(t,e):this.state=x.Reflection.decode(t,e)},t}(),G=function(){function t(){}return t.prototype.setState=function(t){},t.prototype.getState=function(){return null},t.prototype.patch=function(t){},t.prototype.teardown=function(){},t.prototype.handshake=function(t){},t}();O("schema",Y),O("none",G),t.Auth=W,t.Client=X,t.Room=T,t.SchemaSerializer=Y,t.registerSerializer=O,Object.defineProperty(t,"__esModule",{value:!0})})),t("default",o.exports),o.exports.Protocol,o.exports.ErrorCode,o.exports.OPERATION,o.exports.ArraySchema,o.exports.CollectionSchema,o.exports.Context,o.exports.MapSchema,o.exports.Reflection,o.exports.ReflectionField,o.exports.ReflectionType,o.exports.Schema,o.exports.SchemaDefinition,o.exports.SetSchema,o.exports.decode,o.exports.defineTypes,o.exports.deprecated,o.exports.dumpChanges,o.exports.encode,o.exports.filter,o.exports.filterChildren,o.exports.hasFilter,o.exports.registerType,o.exports.type,o.exports.__esModule,o.exports.Auth,o.exports.Client,o.exports.Room,o.exports.SchemaSerializer,o.exports.registerSerializer}),{})}}}));

System.register("chunks:///_virtual/colyseus.mjs_cjs=&original=.js",["./colyseus.js","./cjs-loader.mjs"],(function(e,s){var t,r;return{setters:[function(s){t=s.__cjsMetaURL;var r={};r.__cjsMetaURL=s.__cjsMetaURL,r.default=s.default,e(r)},function(e){r=e.default}],execute:function(){t||r.throwInvalidWrapper("./colyseus.js",s.meta.url),r.require(t)}}}));

System.register("chunks:///_virtual/DataWarehouse.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UserDataGened.ts","./NetworkManager.ts","./JsonCMD.ts","./GameSceneUIManager.ts"],(function(e){var t,o,n,r,a,i,s,p,u,c,l,P,h;return{setters:[function(e){t=e.inheritsLoose,o=e.createForOfIteratorHelperLoose,n=e.createClass},function(e){r=e.cclegacy,a=e.EventTarget,i=e._decorator,s=e.director,p=e.Component},function(e){u=e.UserData},function(e){c=e.networkEventTarget,l=e.NetworkManager},function(e){P=e.JsonCMD},function(e){h=e.GameSceneUIManager}],execute:function(){var y,m;r._RF.push({},"29f7aw+vVhOar/Oz14VxntZ","DataWarehouse",void 0);var g=e("DataWarehouseEventTarget",new a),d=i.ccclass,v=(i.property,e("PropType",function(e){return e.None="None",e.Bomb="Bomb",e.Zoom="Zoom",e.Next="Next",e.Coin="Coin",e}({}))),f=(e("DataWarehouse",d("DataWarehouse")(((m=function(e){function r(){for(var t,o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).UserDataJson=void 0,t.userDataGened=void 0,t.gameData=void 0,t._countDownTime=0,t.dk=void 0,t.mainPlayerPropMap=new Map,t}t(r,e);var a=r.prototype;return a.start=function(){var e=this;this.init(),this.dk=this.getQueryParam("uk"),console.log("dataKey=="+this.dk);var t=localStorage.getItem(this.dk);console.log("userDataStr=="+t),this.UserDataJson=JSON.parse(t),this.userDataGened=u.fromJSON(this.UserDataJson),console.log("UserId==="+this.userDataGened.id),this.gameData=new M,c.on(P.CMD_S2C_usingProp,(function(t){console.log("datawarehouse eventTarget on==="+P.CMD_S2C_usingProp);var o=h.propTypeStr2PropType(t.targetPropTypeStr);if(e.usingOnePropForMainPlayer(o),o!=v.Next){var n=0,a=0;"moveX"in t&&(n=t.moveX),"moveY"in t&&(a=t.moveY);var i=v.None;"openedPropTypeStr"in t&&(i=h.propTypeStr2PropType(t.openedPropTypeStr)),g.emit(r.UsingZoomPropEvent,n,a,i)}}))},a.addOneProp2MainPlayer=function(e){if(this.mainPlayerPropMap.has(e)){var t=this.mainPlayerPropMap.get(e);this.mainPlayerPropMap.set(e,t+1)}else this.mainPlayerPropMap.set(e,1);g.emit(r.UpdateMainPlayerPropEvent)},a.usingOnePropForMainPlayer=function(e){if(this.mainPlayerPropMap.has(e)){var t=this.mainPlayerPropMap.get(e);if(t<=0)return;this.mainPlayerPropMap.set(e,t-1),t-1<=0&&this.mainPlayerPropMap.delete(e)}g.emit(r.UpdateMainPlayerPropEvent)},a.requestUsingOnePropForMainPlayer=function(e){var t=P.C2S_usingProp(e);l.instance.sendMsg2Server(t)},a.requestUsingOneZoomPropForMainPlayer=function(e,t){var o=P.C2S_usingPropZoom(v.Zoom,e,t);l.instance.sendMsg2Server(o),console.log("requestUsingOneZoomPropForMainPlayer==="+o)},a.getMainPlayerPropCount=function(e){return this.mainPlayerPropMap.has(e)?this.mainPlayerPropMap.get(e):0},a.getMainPlayerPropDataArray=function(){for(var e,t=new Array,n=o(this.mainPlayerPropMap.keys());!(e=n()).done;){var r=e.value;t.push(new f(r,this.mainPlayerPropMap.get(r)))}return t},a.getMainPlayerAllPropCount=function(){var e=0;return this.mainPlayerPropMap.forEach((function(t,o){e+=t})),e},a.updateUserData2LocalStorage=function(){var e=this.userDataGened.toJSON();localStorage.setItem(this.dk,e)},r.resetInstance=function(){r._instance=null},a.init=function(){r.instance||(r._instance=this,s.addPersistRootNode(this.node))},a.getQueryParam=function(e){return new URLSearchParams(window.location.search).get(e)},a.onDestory=function(){this.myDestroy()},a.myDestroy=function(){r.instance==this&&(r._instance=null,this.node.destroy())},a.update=function(e){},n(r,[{key:"countDownTime",get:function(){return this._countDownTime},set:function(e){this._countDownTime=e}}],[{key:"instance",get:function(){return this._instance}}]),r}(p))._instance=void 0,m.UpdateMainPlayerPropEvent="UpdateMainPlayerPropEvent",m.UsingZoomPropEvent="UsingZoomPropEvent",m.startZoom=!1,y=m))||y),e("PropData",(function(e,t){this.propType=void 0,this.propCount=void 0,this.propType=e,this.propCount=t}))),M=e("GameData",function(){function e(){this.maxBombCount=10,this.maxZoomPropCount=2,this.maxNextPropCount=2,this.maxCoinsPropCount=1,this.bombCount=this.maxBombCount,this.zoomPropCount=this.maxZoomPropCount,this.nextPropCount=this.maxNextPropCount,this.coinsPropCount=this.maxCoinsPropCount,this.playerDict=new Map,this.curPlayerSessinId=void 0,this.curBetCoins=void 0,this.curMaxPlayer=void 0}var t=e.prototype;return t.addPlayerObj=function(e,t){this.playerDict[e]=t},t.getPlayerObj=function(e){return this.playerDict[e]},t.getSessionIdWithNoWin=function(e){for(var t=0,o=Object.keys(this.playerDict);t<o.length;t++){var n=o[t],r=this.getPlayerObj(n);if(console.log("po.name=="+r.name),console.log("po.status=="+r.status),n!=e&&2!=r.status&&3!=r.status)return n}return console.log("getSessionIdWithNoWin === no sessionId found"),""},t.removePlayerObj=function(e){this.playerDict.delete(e)},t.removeAllPlayerObj=function(){this.playerDict.clear()},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/DrawCicle.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,i,t,o,n,a,c,l,u;return{setters:[function(r){e=r.applyDecoratedDescriptor,i=r.inheritsLoose,t=r.initializerDefineProperty,o=r.assertThisInitialized},function(r){n=r.cclegacy,a=r._decorator,c=r.Graphics,l=r.Component,u=r.Color}],execute:function(){var s,p,f,h;n._RF.push({},"ac3e79CiRZEyKawNHf7p7xb","DrawCicle",void 0);var C=a.ccclass,b=a.property;r("DrawCicle",C("DrawCicle")((f=e((p=function(r){function e(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return e=r.call.apply(r,[this].concat(n))||this,t(e,"raius",f,o(e)),t(e,"cbColor",h,o(e)),e}i(e,r);var n=e.prototype;return n.start=function(){var r=this.getComponent(c);r&&(r.fillColor=this.cbColor,r.rect(0,0,this.raius,this.raius),r.fill())},n.update=function(r){},e}(l)).prototype,"raius",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 37}}),h=e(p.prototype,"cbColor",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.WHITE}}),s=p))||s);n._RF.pop()}}}));

System.register("chunks:///_virtual/FinalWinnerTipViewComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataWarehouse.ts"],(function(e){var t,a,r,i,n,o,l,s,c,p,u,b,f,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,l=e.Label,s=e.Sprite,c=e.Button,p=e.assetManager,u=e.SpriteFrame,b=e.Texture2D,f=e.Component},function(e){g=e.DataWarehouse}],execute:function(){var m,d,y,h,w,v,L,C,F,S,D;n._RF.push({},"520ddiPS7pCtpOQILXb58qg","FinalWinnerTipViewComp",void 0);var z=o.ccclass,T=o.property;e("FinalWinnerTipViewComp",(m=z("FinalWinnerTipViewComp"),d=T(l),y=T(s),h=T(l),w=T(c),m((C=t((L=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,r(t,"playerNameLabel",C,i(t)),r(t,"avatarSprite",F,i(t)),r(t,"rewardCoinsLabel",S,i(t)),r(t,"closeBtn",D,i(t)),t}a(t,e);var n=t.prototype;return n.start=function(){this.closeBtn.node.on("click",(function(){g.instance.updateUserData2LocalStorage(),location.reload()}),this)},n.setAvatar=function(e){var t=this;try{p.loadRemote(e,{ext:".png"},(function(a,r){if(console.log("url",e),a)console.error("Failed to load image:",a);else{var i=new u,n=new b;n.image=r,i.texture=n,t.avatarSprite.spriteFrame=i}}))}catch(e){console.log("===set avatar==="+e)}},n.setPlayerName=function(e){this.playerNameLabel.string=e},n.setRewardCoins=function(e){this.rewardCoinsLabel.string=e.toString()},n.update=function(e){},t}(f)).prototype,"playerNameLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=t(L.prototype,"avatarSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=t(L.prototype,"rewardCoinsLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(L.prototype,"closeBtn",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=L))||v));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameSceneUIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ChoosePropViewComp.ts","./NetworkManager.ts","./JsonCMD.ts","./BoxItemComp.ts","./DataWarehouse.ts","./PeopleItemComp.ts","./FinalWinnerTipViewComp.ts"],(function(e){var o,n,t,r,a,i,l,s,p,u,c,m,b,d,g,P,f,y,C,v,S,x;return{setters:[function(e){o=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,i=e._decorator,l=e.Button,s=e.Node,p=e.Prefab,u=e.Label,c=e.Texture2D,m=e.instantiate,b=e.Component},function(e){d=e.ChoosePropViewComp},function(e){g=e.networkEventTarget},function(e){P=e.JsonCMD},function(e){f=e.BoxItemComp},function(e){y=e.DataWarehouse,C=e.DataWarehouseEventTarget,v=e.PropType},function(e){S=e.PeopleItemComp},function(e){x=e.FinalWinnerTipViewComp}],execute:function(){var w,h,I,D,T,L,z,B,_,N,G,M,V,A,k,E,W,U,Z,q,F,O,j,R,X,Y,J,H,$,K,Q,ee,oe,ne,te,re,ae,ie,le,se,pe,ue;a._RF.push({},"542a0gVlwxMgqkDZWcfk/rg","GameSceneUIManager",void 0);var ce=i.ccclass,me=i.property;e("GameSceneUIManager",(w=ce("GameSceneUIManager"),h=me(l),I=me(s),D=me(s),T=me(p),L=me(p),z=me(p),B=me(p),_=me(u),N=me(u),G=me(u),M=me(u),V=me(u),A=me(u),k=me(u),E=me(c),W=me(c),U=me(c),Z=me(c),q=me(c),w(((ue=function(e){function o(){for(var o,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return o=e.call.apply(e,[this].concat(a))||this,t(o,"magicPropsBtn",j,r(o)),t(o,"bombGrid",R,r(o)),t(o,"playerGrid",X,r(o)),t(o,"boxItemPrefab",Y,r(o)),t(o,"peopleItemPrefab",J,r(o)),t(o,"propsViewPrefab",H,r(o)),t(o,"finalWinnerTipViewPrefab",$,r(o)),t(o,"bombLabel",K,r(o)),t(o,"coinsLabel",Q,r(o)),t(o,"zoomPropLabel",ee,r(o)),t(o,"nextPropLabel",oe,r(o)),t(o,"coinPropLabel",ne,r(o)),t(o,"playerCountLabel",te,r(o)),t(o,"allExistPropCountLabel",re,r(o)),t(o,"bombTex2d",ae,r(o)),t(o,"zoomTex2d",ie,r(o)),t(o,"nextTex2d",le,r(o)),t(o,"coinTex2d",se,r(o)),t(o,"luckyTex2d",pe,r(o)),o.Bomb2dArray=void 0,o.bomb2dGridDict=new Map,o.cdPeopleItemComp=null,o}n(o,e);var a=o.prototype;return a.start=function(){var e=this;o.Instance=this,this.magicPropsBtn.node.on("click",(function(){e.popUpPropsView()}),this),this.Bomb2dArray=this.createBomb2dArray(),this.initNetworkEvent(),this.initGameData(y.instance.gameData),this.initPlayerSeats(),this.updatePlayerSeatsSeq(),C.on(y.UpdateMainPlayerPropEvent,(function(){e.allExistPropCountLabel.string=y.instance.getMainPlayerAllPropCount().toString()})),C.on(y.UsingZoomPropEvent,(function(o,n,t){var r=e.Bomb2dArray[o][n],a=e.bomb2dGridDict.get(r);a.openBox(t,!1,null),setTimeout((function(){a.closeBox()}),3e3)}))},o.getPropTex2d=function(e){switch(e){case v.Bomb:return o.Instance.bombTex2d;case v.Zoom:return o.Instance.zoomTex2d;case v.Next:return o.Instance.nextTex2d;case v.Coin:return o.Instance.coinTex2d;case v.None:return o.Instance.luckyTex2d}return null},a.initGameData=function(e){console.log("initGameData==="+e),this.playerCountLabel.string=e.curBetCoins+"$ ("+e.curMaxPlayer+"p)",this.bombLabel.string=e.bombCount+"/"+e.maxBombCount,this.coinsLabel.string=y.instance.userDataGened.coins,this.zoomPropLabel.string=e.zoomPropCount+"/"+e.maxZoomPropCount,this.nextPropLabel.string=e.nextPropCount+"/"+e.maxNextPropCount,this.coinPropLabel.string=e.coinsPropCount+"/"+e.maxCoinsPropCount},a.initPlayerSeats=function(){var e=this;console.log("gameSceneUI===initPlayerSeats===");var o=y.instance.gameData;Object.keys(o.playerDict).forEach((function(n){console.log("sessionId==="+n);var t=o.playerDict[n],r=m(e.peopleItemPrefab),a=r.getComponent(S);a.disableRightWrongNode(),a.setAvatar(t.avatar),a.setNickName(t.name);var i=y.instance.gameData.curPlayerSessinId==t.sessionId;a.setIsCurrentPlayer(i),a.sessionId=t.sessionId,a.seatSeq=t.seatSeq,e.playerGrid.addChild(r)}))},a.updatePlayerSeatsSeq=function(){var e=this,o=this.playerGrid.children;o.sort((function(e,o){var n=e.getComponent("PeopleItemComp"),t=o.getComponent("PeopleItemComp");return n.seatSeq-t.seatSeq})),o.forEach((function(o){e.playerGrid.addChild(o)}))},a.popUpPropsView=function(){if(null==o.propsViewNode){o.propsViewNode=m(this.propsViewPrefab),this.node.addChild(o.propsViewNode);var e=o.propsViewNode.getComponent(d);return e.initData(y.instance.getMainPlayerPropDataArray()),e}},a.createBomb2dArray=function(){for(var e=new Array(8).fill(0).map((function(){return new Array(8).fill(null)})),o=0;o<8;o++)for(var n=0;n<8;n++){e[o][n]={propType:"None",moveX:o,moveY:n,userId:-1};var t=m(this.boxItemPrefab);this.bombGrid.addChild(t);var r=t.getComponent(f);r.moveX=o,r.moveY=n,this.bomb2dGridDict.set(e[o][n],r)}return e},a.findSeatBySessionId=function(e){var o=this.playerGrid.children,n=null;return o.forEach((function(o){var t=o.getComponent(S);if(console.log("peopleItemComp.sessionId==="+t.sessionId),t.sessionId==e)return console.log("findSeatBySessionId===finded"+e),n=t,t})),n},a.setAllSeatCancelCountDownStatus=function(){this.playerGrid.children.forEach((function(e){e.getComponent(S).CancelCountDownTime()}))},a.initNetworkEvent=function(){var e=this;g.on(P.CMD_S2C_playerMove,(function(n){console.log("eventTarget on==="+P.CMD_S2C_playerMove);var t=n.moveX,r=n.moveY,a=(n.propTypeStr,e.Bomb2dArray[t][r]),i=e.bomb2dGridDict.get(a),l=o.propTypeStr2PropType(n.propTypeStr),s=n.sessionId,p=y.instance.gameData.curPlayerSessinId==s;p&&l!=v.Bomb&&l!=v.None&&y.instance.addOneProp2MainPlayer(l);var u=y.instance.gameData.getPlayerObj(s);i.openBox(l,p,u.avatar)})),g.on(P.Server_Property_movingPlayerSessionId,(function(n){(console.log("eventTarget on Server_Property_movingPlayerSessionId==="+P.Server_Property_movingPlayerSessionId),e.setAllSeatCancelCountDownStatus(),e.cdPeopleItemComp=e.findSeatBySessionId(n),console.log("eventTarget on findSeatBySessionId==="+n),y.instance.gameData.curPlayerSessinId==n)?(o.startLocalTurn(),Number(e.allExistPropCountLabel.string)>0&&e.popUpPropsView()):o.stopLocalTurn()})),g.on(P.Server_Property_countDownTime,(function(o){console.log("every player countdown eventTarget on==="+o),null!=e.cdPeopleItemComp?e.cdPeopleItemComp.setCountDownTime(o):console.log("cdPeopleItemComp is null")})),g.on(P.Server_Property_playerStatus,(function(o,n){var t=e.findSeatBySessionId(o);3==n&&t.setFailed(),console.log("every player countdown eventTarget on==="+n)})),g.on(P.CMD_S2C_gameOver,(function(o,n){var t=m(e.finalWinnerTipViewPrefab);e.node.addChild(t);var r=t.getComponent(x),a=y.instance.gameData.getSessionIdWithNoWin(o),i=e.findSeatBySessionId(a);null!=i&&(console.log("setfailed name==="+i.getNickName()),i.CancelCountDownTime(),i.setFailed());var l=y.instance.gameData.getPlayerObj(o);r.setAvatar(l.avatar),r.setRewardCoins(n),r.setPlayerName(l.name),console.log("CMD_S2C_gameOver eventTarget on==="+o+"|"+n)})),g.on(P.Server_Property_bombCount,(function(o){y.instance.gameData.bombCount=y.instance.gameData.maxBombCount-o,e.bombLabel.string=y.instance.gameData.bombCount+"/"+y.instance.gameData.maxBombCount})),g.on(P.Server_Property_coinPropCount,(function(o){y.instance.gameData.coinsPropCount=y.instance.gameData.maxCoinsPropCount-o;var n=y.instance.gameData;e.coinPropLabel.string=n.coinsPropCount+"/"+n.maxCoinsPropCount})),g.on(P.Server_Property_nextPropCount,(function(o){var n=y.instance.gameData;n.nextPropCount=n.maxNextPropCount-o,e.nextPropLabel.string=n.nextPropCount+"/"+n.maxNextPropCount})),g.on(P.Server_Property_zoomPropCount,(function(o){var n=y.instance.gameData;n.zoomPropCount=n.maxZoomPropCount-o,e.zoomPropLabel.string=n.zoomPropCount+"/"+n.maxZoomPropCount}))},o.startLocalTurn=function(){o.isAllowSel=!0},o.stopLocalTurn=function(){o.isAllowSel=!1},o.propTypeStr2PropType=function(e){return v.Bomb.toString()==e?v.Bomb:v.Coin.toString()==e?v.Coin:v.Next.toString()==e?v.Next:v.None.toString()==e?v.None:v.Zoom.toString()==e?v.Zoom:v.None},a.update=function(e){},o}(b)).Instance=void 0,ue.propsViewNode=void 0,ue.isAllowSel=void 0,j=o((O=ue).prototype,"magicPropsBtn",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=o(O.prototype,"bombGrid",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=o(O.prototype,"playerGrid",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=o(O.prototype,"boxItemPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=o(O.prototype,"peopleItemPrefab",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=o(O.prototype,"propsViewPrefab",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=o(O.prototype,"finalWinnerTipViewPrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=o(O.prototype,"bombLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=o(O.prototype,"coinsLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=o(O.prototype,"zoomPropLabel",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=o(O.prototype,"nextPropLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=o(O.prototype,"coinPropLabel",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te=o(O.prototype,"playerCountLabel",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=o(O.prototype,"allExistPropCountLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ae=o(O.prototype,"bombTex2d",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=o(O.prototype,"zoomTex2d",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le=o(O.prototype,"nextTex2d",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=o(O.prototype,"coinTex2d",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=o(O.prototype,"luckyTex2d",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=O))||F));a._RF.pop()}}}));

System.register("chunks:///_virtual/InitComp.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,o,n,i,a,s,c,l;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,s=e.ProgressBar,c=e.director,l=e.Component}],execute:function(){var p,u,f,y,g;i._RF.push({},"4fae5quA4hBnaooLI09/6Ko","InitComp",void 0);var m=a.ccclass,d=a.property;e("InitComp",(p=m("InitComp"),u=d({type:s}),p((g=r((y=function(e){function r(){for(var r,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return r=e.call.apply(e,[this].concat(i))||this,o(r,"myProgressBar",g,n(r)),r}t(r,e);var i=r.prototype;return i.start=function(){c.loadScene("MainScene"),console.log("ssss")},i.update=function(e){},r}(l)).prototype,"myProgressBar",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=y))||f));i._RF.pop()}}}));

System.register("chunks:///_virtual/JsonCMD.ts",["cc"],(function(r){var e;return{setters:[function(r){e=r.cclegacy}],execute:function(){e._RF.push({},"1de786ddthCarCE0ghRkQmN","JsonCMD",void 0);var o=r("JsonCMD",function(){function r(){}return r.C2S_isReady=function(e){var o={cmd:r.CMD_C2S_isReady,value:e};return JSON.stringify(o)},r.S2C_allReady=function(){var e={cmd:r.CMD_S2C_allReady};return JSON.stringify(e)},r.C2S_playerMove=function(e,o){var n={cmd:r.CMD_C2S_playerMove,moveX:e,moveY:o};return JSON.stringify(n)},r.C2S_usingProp=function(e){var o={cmd:r.CMD_C2S_usingProp,propTypeStr:e.toString()};return JSON.stringify(o)},r.C2S_usingPropZoom=function(e,o,n){var t={cmd:r.CMD_C2S_usingProp,propTypeStr:e.toString(),moveX:o,moveY:n};return JSON.stringify(t)},r}());o.CMD_S2C_allReady="S2C_allReady",o.CMD_S2C_allMached="S2C_allMached",o.CMD_S2C_playerMove="S2C_playerMove",o.CMD_S2C_gameOver="S2C_gameOver",o.CMD_S2C_startGameFailed="S2C_startGameFailed",o.CMD_S2C_usingProp="S2C_usingProp",o.CMD_C2S_isReady="C2S_isReady",o.CMD_C2S_playerMove="C2S_playerMove",o.CMD_C2S_usingProp="C2S_usingProp",o.Server_Property_countDownTime="countDownTime",o.Server_Property_movingPlayerSessionId="movingPlayerSessionId",o.Server_Property_playersIn="playersIn",o.Server_Property_playersOut="playersOut",o.Server_Property_isReady="isReady",o.Server_Property_playerStatus="status",o.Server_Property_coinPropCount="coinPropCount",o.Server_Property_nextPropCount="nextPropCount",o.Server_Property_zoomPropCount="zoomPropCount",o.Server_Property_bombCount="bombCount",e._RF.pop()}}}));

System.register("chunks:///_virtual/LangJsonReflecion.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"f339eJvUw1K8oEZDRIIUAqH","LangJsonReflecion",void 0);e("LangBasic",function(){function e(e,n,o,i,t,c,r,s,a){this.languagecode=void 0,this.nativeName=void 0,this.flagUrl=void 0,this.phoneCode=void 0,this.countryCode=void 0,this.countryName=void 0,this.chineseName=void 0,this.currencyCode=void 0,this.currencySymbol=void 0,this.languagecode=e,this.nativeName=n,this.flagUrl=o,this.phoneCode=i,this.countryCode=t,this.countryName=c,this.chineseName=r,this.currencyCode=s,this.currencySymbol=a}return e.fromJSON=function(n){return new e(n.languagecode,n.nativeName,n.flagUrl,n.phoneCode,n.countryCode,n.countryName,n.chineseName,n.currencyCode,n.currencySymbol)},e}());n._RF.pop()}}}));

System.register("chunks:///_virtual/LocalLangManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LangJsonReflecion.ts"],(function(n){var t,a,e,o,c,i;return{setters:[function(n){t=n.inheritsLoose,a=n.createClass},function(n){e=n.cclegacy,o=n._decorator,c=n.Component},function(n){i=n.LangBasic}],execute:function(){var s,r;e._RF.push({},"92c135hxMJMb6VdUt1thLQc","LocalLangManager",void 0);var l=o.ccclass;o.property,n("LocalLangManager",l("LocalLangManager")(((r=function(n){function e(){for(var t,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return(t=n.call.apply(n,[this].concat(e))||this).langBasic=void 0,t}t(e,n);var o=e.prototype;return o.start=function(){this.init()},e.resetInstance=function(){e._instance=null},o.loadLangConfig=function(){var n=this;fetch("https://api.luckybooms.com/api/config/game_center").then((function(n){return n.text()})).then((function(t){var a=JSON.parse(t);200==a.code?(console.log("请求游戏语言配置成功"),n.langBasic=i.fromJSON(a.data.basic),console.log("langvalue=="+n.langBasic.phoneCode)):console.log("请求游戏语言配置失败："+a.message)}))},o.init=function(){e.instance||(e._instance=this),this.loadLangConfig()},o.update=function(n){},a(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(c))._instance=void 0,s=r))||s);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./NetworkManager.ts","./BoxItemComp.ts","./ChoosePropViewComp.ts","./DataWarehouse.ts","./DrawCicle.ts","./FinalWinnerTipViewComp.ts","./GameSceneUIManager.ts","./UserDataGened.ts","./InitComp.ts","./JsonCMD.ts","./LangJsonReflecion.ts","./LocalLangManager.ts","./MainSceneComp.ts","./MainSceneUIManager.ts","./PageAdapter.ts","./PeopleItemComp.ts","./SelectPropItemComp.ts","./Bomb2dUnit.ts","./Player.ts","./TipViewMatching.ts","./WaittingRoomSceneUIManager.ts","./colyseus.mjs_cjs=&original=.js"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainSceneComp.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var e,t,o,c;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,o=n._decorator,c=n.Component}],execute:function(){var r;t._RF.push({},"833c6F4U3hM+LA89ABbktoe","MainSceneComp",void 0);var i=o.ccclass;o.property,n("Main",i("Main")(r=function(n){function t(){return n.apply(this,arguments)||this}e(t,n);var o=t.prototype;return o.start=function(){console.log("====main secne===")},o.update=function(n){},t}(c))||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/MainSceneUIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TipViewMatching.ts","./NetworkManager.ts","./JsonCMD.ts"],(function(n){var e,i,t,o,a,r,c,p,l,u,s,g,f,h,M;return{setters:[function(n){e=n.applyDecoratedDescriptor,i=n.inheritsLoose,t=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){a=n.cclegacy,r=n._decorator,c=n.Button,p=n.resources,l=n.director,u=n.instantiate,s=n.Component},function(n){g=n.TipViewMatching},function(n){f=n.networkEventTarget,h=n.NetworkManager},function(n){M=n.JsonCMD}],execute:function(){var _,b,w,d,B,T,y,V,v,m,U,k,C,S,z;a._RF.push({},"a57a88/ecRL9LoAT+UrGkxZ","MainSceneUIManager",void 0);var D=r.ccclass,P=r.property;n("MainSceneUIManager",(_=D("MainSceneUIManager"),b=P(c),w=P(c),d=P(c),B=P(c),T=P(c),y=P(c),_((m=e((v=function(n){function e(){for(var e,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return e=n.call.apply(n,[this].concat(a))||this,t(e,"p10_5Btn",m,o(e)),t(e,"p10_10Btn",U,o(e)),t(e,"p30_5Btn",k,o(e)),t(e,"p30_10Btn",C,o(e)),t(e,"p50_5Btn",S,o(e)),t(e,"p50_10Btn",z,o(e)),e.tipViewMatchingPrefab=void 0,e}i(e,n);var a=e.prototype;return a.start=function(){var n=this;p.load("Prefabs/TipView",(function(e,i){e?console.error(e):(n.tipViewMatchingPrefab=i,console.log("==="+n.tipViewMatchingPrefab))})),this.p10_5Btn.node.on("click",(function(){n.popUpTipViewMatching(10,5)})),this.p10_10Btn.node.on("click",(function(){n.popUpTipViewMatching(10,10)})),this.p30_5Btn.node.on("click",(function(){n.popUpTipViewMatching(30,5)})),this.p30_10Btn.node.on("click",(function(){n.popUpTipViewMatching(30,10)})),this.p50_5Btn.node.on("click",(function(){n.popUpTipViewMatching(50,5)})),this.p50_10Btn.node.on("click",(function(){n.popUpTipViewMatching(50,10)})),f.on(M.CMD_S2C_allMached,(function(n){console.log("main scene ui eventTarget on==="+M.CMD_S2C_allMached),l.loadScene("WaittingRoomScene")}))},a.popUpTipViewMatching=function(n,e){h.instance.selectRoom(e,n);var i=u(this.tipViewMatchingPrefab);this.node.addChild(i);var t=i.getComponent(g);t.peopleTf.string="【"+e+" - 人】",t.costTf.string="入场费 "+n+" $"},a.update=function(n){},e}(s)).prototype,"p10_5Btn",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=e(v.prototype,"p10_10Btn",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=e(v.prototype,"p30_5Btn",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=e(v.prototype,"p30_10Btn",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=e(v.prototype,"p50_5Btn",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=e(v.prototype,"p50_10Btn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=v))||V));a._RF.pop()}}}));

System.register("chunks:///_virtual/NetworkManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./colyseus.mjs_cjs=&original=.js","./DataWarehouse.ts","./JsonCMD.ts","./colyseus.js"],(function(e){var o,t,n,r,s,i,a,c,l,u,m,p,_,d;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,s=e.createClass,i=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){c=e.cclegacy,l=e._decorator,u=e.EventTarget,m=e.Component},null,function(e){p=e.DataWarehouse},function(e){_=e.JsonCMD},function(e){d=e.default}],execute:function(){var g,h,y,v,f,C;c._RF.push({},"b8118njwd1PVoKzJl7q74hH","NetworkManager",void 0);var S=l.ccclass,P=l.property,D=e("networkEventTarget",new u);e("NetworkManager",S("NetworkManager")(((C=function(e){function o(){for(var o,t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];return o=e.call.apply(e,[this].concat(s))||this,n(o,"hostname",y,r(o)),n(o,"port",v,r(o)),n(o,"useSSL",f,r(o)),o.client=void 0,o.room=void 0,o}t(o,e);var c=o.prototype;return c.start=function(){console.log("===NetworkManager start==="),this.init()},c.init=function(){o.instance||(o._instance=this)},o.resetInstance=function(){o._instance=null},c.selectRoom=function(e,o){var t=p.instance.userDataGened;this.connect({userName:t.nickname,userId:t.id,betCoins:o,maxClients:e,avatar:t.avatar,coins:t.coins})},c.leaveRoom=function(){this.room.leave()},c.sendMsg2Server=function(e){this.room.send("C2S",e)},c.connect=function(){var e=i(a().mark((function e(o){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("hostname =="+this.hostname),this.client=new d.Client((this.useSSL?"wss":"ws")+"://"+this.hostname+([443,80].includes(this.port)||this.useSSL?"":":"+this.port)),e.next=5,this.client.joinOrCreate("roomAuto",o);case 5:this.room=e.sent,p.instance.gameData.curPlayerSessinId=this.room.sessionId,p.instance.gameData.curBetCoins=o.betCoins,p.instance.gameData.curMaxPlayer=o.maxClients,console.log("joined successfully!"),console.log("user's sessionId:",this.room.sessionId),this.room.state.listen("countDownTime",(function(e){console.log("countDownTime=="+e),D.emit(_.Server_Property_countDownTime,e)})),this.room.state.listen(_.Server_Property_movingPlayerSessionId,(function(e){console.log("curPlayerUserId change to=="+e),D.emit(_.Server_Property_movingPlayerSessionId,e)})),this.room.state.listen(_.Server_Property_coinPropCount,(function(e){console.log("Server_Property_coinPropCount change to=="+e),D.emit(_.Server_Property_coinPropCount,e)})),this.room.state.listen(_.Server_Property_bombCount,(function(e){console.log("Server_Property_bombCount change to=="+e),D.emit(_.Server_Property_bombCount,e)})),this.room.state.listen(_.Server_Property_nextPropCount,(function(e){console.log("Server_Property_nextPropCount change to=="+e),D.emit(_.Server_Property_nextPropCount,e)})),this.room.state.listen(_.Server_Property_zoomPropCount,(function(e){console.log("Server_Property_zoomPropCount change to=="+e),D.emit(_.Server_Property_zoomPropCount,e)})),this.room.state.players.onAdd((function(e,o){console.log(e,"has been added at",o),p.instance.gameData.addPlayerObj(o,e),D.emit(_.Server_Property_playersIn,e),e.listen("isReady",(function(o,t){console.log("isReady",o),D.emit(_.Server_Property_isReady,e.sessionId,e.isReady)})),e.listen("status",(function(o,t){console.log("status",o),D.emit(_.Server_Property_playerStatus,e.sessionId,o)})),e.listen("coins",(function(e){console.log("my conis change to:",e),p.instance.userDataGened.coins=e}))})),this.room.state.players.onRemove((function(e,o){console.log(e,"has been removed at",o),p.instance.gameData.removePlayerObj(o),D.emit(_.Server_Property_playersOut,e)})),this.room.onMessage("S2C",(function(e){console.log("Received message from server:",e);var o=JSON.parse(e);if(console.log("excute=="+o.cmd),o.cmd==_.CMD_S2C_allReady)console.log("excute S2C_allReady"),D.emit(o.cmd);else if(o.cmd==_.CMD_S2C_allMached)console.log("excute "+_.CMD_S2C_allMached),D.emit(o.cmd);else if(o.cmd==_.CMD_S2C_playerMove)console.log("excute "+_.CMD_S2C_playerMove),D.emit(o.cmd,o);else if(o.cmd==_.CMD_S2C_gameOver){console.log("excute "+_.CMD_S2C_gameOver);var t=o.sessionId,n=o.rewardCoins;D.emit(o.cmd,t,n)}else o.cmd==_.CMD_S2C_startGameFailed?(console.log("excute "+_.CMD_S2C_startGameFailed),D.emit(o.cmd)):o.cmd==_.CMD_S2C_usingProp&&(console.log("excute "+_.CMD_S2C_usingProp),D.emit(o.cmd,o))})),this.room.onLeave((function(e){console.log("onLeave:",e)})),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error(e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(o){return e.apply(this,arguments)}}(),s(o,null,[{key:"instance",get:function(){return this._instance}}]),o}(m))._instance=void 0,y=o((h=C).prototype,"hostname",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"localhost"}}),v=o(h.prototype,"port",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2567}}),f=o(h.prototype,"useSSL",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),g=h))||g);c._RF.pop()}}}));

System.register("chunks:///_virtual/PageAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(){var e,t,i,a,o,n,r,h,s,d,c,g,p,l,u,m,w,f;return{setters:[function(o){e=o.applyDecoratedDescriptor,t=o.inheritsLoose,i=o.initializerDefineProperty,a=o.assertThisInitialized},function(e){o=e.cclegacy,n=e._decorator,r=e.Enum,h=e.Widget,s=e.director,d=e.Canvas,c=e.Camera,g=e.log,p=e.view,l=e.Size,u=e.screen,m=e.UITransform,w=e.tween,f=e.Component}],execute:function(){var v,N,y,A,P,C,b;o._RF.push({},"55126sP8RVHmJgxFmOmSP8N","PageAdapter",void 0);var z=n.ccclass,S=n.property,_=n.menu,D=function(e){return e[e["无"]=0]="无",e[e["拉伸全屏"]=1]="拉伸全屏",e[e["等比缩放"]=2]="等比缩放",e}(D||{}),M=(v=_("Gi/PageAdapter"),N=S({type:r(D),displayName:"适配模式"}),z(y=v((P=e((A=function(e){function o(){for(var t,o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,i(t,"adapterMode",P,a(t)),t.rootNode=null,t.cameraNode=null,t}t(o,e);var n=o.prototype;return n.onLoad=function(){var e=this.node.getComponent(h);e&&(e.enabled=!1),this.rootNode=s.getScene().getComponentInChildren(d).node,this.cameraNode=this.rootNode.getComponentInChildren(c).node,this.rootNode&&this.cameraNode||(g("PageAdapter添加失败！(未找到Canvas或Camera组件)"),this.destroy())},n.onEnable=function(){this.updateAdapter(),p.on("canvas-resize",this.updateAdapter,this)},n.onDisable=function(){p.off("canvas-resize",this.updateAdapter,this)},n.updateAdapter=function(){var e=new l(u.windowSize.width/p._scaleX,u.windowSize.height/p._scaleY),t=this.node.getComponent(m),i=p.getDesignResolutionSize();if(t.width<t.height==i.width<i.height)0!==this.cameraNode.angle&&w(this.cameraNode).to(1,{angle:0},{easing:"expoOut"}).start();else{var a=[e.height,e.width];e.width=a[0],e.height=a[1],-90!==this.cameraNode.angle&&w(this.cameraNode).to(1,{angle:-90},{easing:"expoOut"}).start()}switch(this.adapterMode){case D.拉伸全屏:this.rootNode.setScale(e.width/t.width,e.height/t.height),this.node.setPosition(e.width*(t.anchorX-.5),e.height*(t.anchorY-.5));break;case D.等比缩放:var o=e.width/e.height>t.width/t.height?e.height/t.height:e.width/t.width;this.rootNode.setScale(o,o),this.node.setPosition(t.width*(t.anchorX-.5),t.height*(t.anchorY-.5))}},o}(f)).prototype,"adapterMode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return D.等比缩放}}),y=A))||y)||y);(C=(b=globalThis).gi||(b.gi={})).PageAdapter||(C.PageAdapter=Object.assign(M,{AdapterMode:D})),o._RF.pop()}}}));

System.register("chunks:///_virtual/PeopleItemComp.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,o,r,n,l,a,s,c,u,h,p,g,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){n=e.cclegacy,l=e._decorator,a=e.Sprite,s=e.Node,c=e.Label,u=e.Color,h=e.assetManager,p=e.SpriteFrame,g=e.Texture2D,d=e.Component}],execute:function(){var C,f,b,m,w,v,F,y,N,I,D,S,x,P,T,L,R,z,_;n._RF.push({},"aa69duTvOlPsYiZlPH5+m/+","PeopleItemComp",void 0);var W=l.ccclass,k=l.property;e("PeopleItemComp",(C=W("PeopleItemComp"),f=k(a),b=k(a),m=k(s),w=k(s),v=k(c),F=k(s),y=k(c),N=k(a),C((S=t((D=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,o(t,"circleSp",S,r(t)),o(t,"avatarSp",x,r(t)),o(t,"wrongNode",P,r(t)),o(t,"rightNode",T,r(t)),o(t,"nameLabel",L,r(t)),o(t,"failedNode",R,r(t)),o(t,"countDownLabel",z,r(t)),o(t,"countDownSprite",_,r(t)),t._isCurrentPlayer=!1,t.sessionId=void 0,t.seatSeq=void 0,t.isDisableRightWrongNode=!1,t}i(t,e);var n=t.prototype;return n.start=function(){},n.hexToColor=function(e){if(6===(e=e.replace(/^#/,"")).length)return new u(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16));if(8===e.length)return new u(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16),parseInt(e.slice(6,8),16));throw new Error("Invalid hex color format")},n.setFailed=function(){this.failedNode.active=!0},n.setReady=function(e){this.isDisableRightWrongNode||this.setRightIcon(e),this._isCurrentPlayer?this.setCircleColor(this.hexToColor("#FF9F04")):e?this.setCircleColor(this.hexToColor("#13CE20")):this.setCircleColor(this.hexToColor("#FFFFFF"))},n.disableRightWrongNode=function(){this.rightNode.active=!1,this.wrongNode.active=!1,this.isDisableRightWrongNode=!0},n.setCountDownTime=function(e){this.countDownSprite.color=new u(255,255,255,255),this.countDownLabel.string=e},n.CancelCountDownTime=function(){this.countDownSprite.color=new u(255,255,255,0)},n.setRightIcon=function(e){e?(this.rightNode.active=!0,this.wrongNode.active=!1):(this.rightNode.active=!1,this.wrongNode.active=!0)},n.setLeave=function(e){e?this.setCircleColor(this.hexToColor("#C1C1C1")):this.setCircleColor(this.hexToColor("#FFFFFF"))},n.setNickName=function(e){e.length>6&&(e=e.slice(0,6)+"..."),this.nameLabel.string=e},n.getNickName=function(){return this.nameLabel.string},n.setIsCurrentPlayer=function(e){this._isCurrentPlayer=e,this._isCurrentPlayer&&(this.nameLabel.color=this.hexToColor("#FFC003"),this.setCircleColor(this.hexToColor("#FF9F04")))},n.setAvatar=function(e){var t=this,i=decodeURI(e);try{h.loadRemote(i,{ext:".png"},(function(e,o){if(console.log("url",i),e)console.error("Failed to load image:",e);else{var r=new p,n=new g;n.image=o,r.texture=n,t.avatarSp.spriteFrame=r,t.avatarSp.node.width=47.47,t.avatarSp.node.height=72}}))}catch(e){console.log("===set avatar==="+e)}},n.setCircleColor=function(e){this.circleSp.color=e,console.log("setcirclecolor=="+e)},n.update=function(e){},t}(d)).prototype,"circleSp",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=t(D.prototype,"avatarSp",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=t(D.prototype,"wrongNode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(D.prototype,"rightNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=t(D.prototype,"nameLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=t(D.prototype,"failedNode",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=t(D.prototype,"countDownLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=t(D.prototype,"countDownSprite",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=D))||I));n._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["cc"],(function(i){var s;return{setters:[function(i){s=i.cclegacy}],execute:function(){s._RF.push({},"b4145b5FR5Gr4WGUCUknvob","Player",void 0);i("Player",(function(){this.userName=void 0,this.userId=void 0,this.sessionId=void 0,this.name=void 0,this.coins=void 0,this.isReady=void 0,this.isOnline=void 0}));s._RF.pop()}}}));

System.register("chunks:///_virtual/SelectPropItemComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataWarehouse.ts","./GameSceneUIManager.ts"],(function(e){var t,o,r,n,i,p,c,l,u,a,s,g,f,P,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){i=e.cclegacy,p=e._decorator,c=e.EventTarget,l=e.Sprite,u=e.Label,a=e.Button,s=e.Color,g=e.SpriteFrame,f=e.Component},function(e){P=e.PropType},function(e){h=e.GameSceneUIManager}],execute:function(){var y,m,C,b,B,T,_,v,I,S,d;i._RF.push({},"c231fQ2wFpER5lI69Z7lLHx","SelectPropItemComp",void 0);var w=p.ccclass,E=p.property,L=e("selectPropItemEventTarget",new c);e("SelectPropItemComp",(y=w("SelectPropItemComp"),m=E(l),C=E(u),b=E(a),B=E(l),y((v=t((_=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),p=0;p<o;p++)i[p]=arguments[p];return t=e.call.apply(e,[this].concat(i))||this,r(t,"propBg",v,n(t)),r(t,"countLabel",I,n(t)),r(t,"selectBtn",S,n(t)),r(t,"colorBg",d,n(t)),t._curPropType=P.None,t._curPropCount=0,t._originBgColor=void 0,t}o(t,e);var i=t.prototype;return i.start=function(){var e=this;this._originBgColor=this.colorBg.color,this.selectBtn.node.on("click",(function(){L.emit("selectPropItemEvent",e._curPropType),console.log("===selectPropItemEvent==="+e._curPropType)}))},i.select=function(){this.colorBg.color=s.GREEN},i.unSelect=function(){this.resetBgColor()},i.resetBgColor=function(){this.colorBg.color=new s(255,220,105,255)},i.initData=function(e){this._curPropType=e.propType,console.log("===propType===",e.propType);var t=h.getPropTex2d(e.propType),o=new g;o.texture=t,this.propBg.spriteFrame=o,this.setPropCount(e.propCount)},i.setPropCount=function(e){this._curPropCount=e,this.countLabel.string="x"+this._curPropCount.toString()},i.getPropCount=function(){return this._curPropCount},i.getPropType=function(){return this._curPropType},i.update=function(e){},t}(f)).prototype,"propBg",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=t(_.prototype,"countLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=t(_.prototype,"selectBtn",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=t(_.prototype,"colorBg",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=_))||T));i._RF.pop()}}}));

System.register("chunks:///_virtual/TipViewMatching.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DataWarehouse.ts"],(function(e){var t,n,a,i,r,o,l,c,u,s,p,f,g,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,l=e.Label,c=e.Button,u=e.Sprite,s=e.assetManager,p=e.SpriteFrame,f=e.Texture2D,g=e.Component},function(e){b=e.DataWarehouse}],execute:function(){var h,y,d,v,m,w,T,z,B,D,F,M,S;r._RF.push({},"2322bl9nRNFgL5Rfz1GJvJ5","TipViewMatching",void 0);var R=o.ccclass,L=o.property;e("TipViewMatching",(h=R("TipViewMatching"),y=L({type:l}),d=L({type:l}),v=L({type:c}),m=L(c),w=L(u),h((B=t((z=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,a(t,"peopleTf",B,i(t)),a(t,"costTf",D,i(t)),a(t,"closeBtn",F,i(t)),a(t,"cancelBtn",M,i(t)),a(t,"avatarSp",S,i(t)),t}n(t,e);var r=t.prototype;return r.start=function(){var e=this;if(null!=b.instance.userDataGened){var t=b.instance.userDataGened.avatar;console.log("url===avatar===",t),null!=t&&""!=t&&s.loadRemote(t,(function(n,a){if(console.log("url",t),n)console.error("Failed to load image:",n);else{var i=new p,r=new f;r.image=a,i.texture=r,e.avatarSp.spriteFrame=i}}))}this.closeBtn.node.on("click",(function(){e.node.destroy()}),this),this.cancelBtn.node.on("click",(function(){e.node.destroy()}),this)},r.update=function(e){},t}(g)).prototype,"peopleTf",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(z.prototype,"costTf",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=t(z.prototype,"closeBtn",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=t(z.prototype,"cancelBtn",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=t(z.prototype,"avatarSp",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=z))||T));r._RF.pop()}}}));

System.register("chunks:///_virtual/UserDataGened.ts",["cc"],(function(i){var t;return{setters:[function(i){t=i.cclegacy}],execute:function(){t._RF.push({},"c3b1aIvGZRDf760Fq0iLRfz","UserDataGened",void 0);i("UserData",function(){function i(i,t,e,s,o,a,n,h,r,d,c,v,p,u,l,m,f){this.id=void 0,this.email=void 0,this.phoneNumber=void 0,this.countrycode=void 0,this.flagUrl=void 0,this.phoneCode=void 0,this.username=void 0,this.password=void 0,this.nickname=void 0,this.avatar=void 0,this.invitationCode=void 0,this.agent=void 0,this.coins=void 0,this.token=void 0,this.created_at=void 0,this.level=void 0,this.paypassword=void 0,this.id=i,this.email=t,this.phoneNumber=e,this.countrycode=s,this.flagUrl=o,this.phoneCode=a,this.username=n,this.password=h,this.nickname=r,this.avatar=d,this.invitationCode=c,this.agent=v,this.coins=p,this.token=u,this.created_at=l,this.level=m,this.paypassword=f}return i.fromJSON=function(t){return new i(t.id,t.email,t.phoneNumber,t.countrycode,t.flagUrl,t.phoneCode,t.username,t.password,t.nickname,t.avatar,t.invitationCode,t.agent,t.coins,t.token,t.created_at,t.level,t.paypassword)},i.prototype.toJSON=function(){return JSON.stringify({id:this.id,email:this.email,phoneNumber:this.phoneNumber,countrycode:this.countrycode,flagUrl:this.flagUrl,phoneCode:this.phoneCode,username:this.username,password:this.password,nickname:this.nickname,avatar:this.avatar,invitationCode:this.invitationCode,agent:this.agent,coins:this.coins,token:this.token,created_at:this.created_at,level:this.level,paypassword:this.paypassword})},i}());t._RF.pop()}}}));

System.register("chunks:///_virtual/WaittingRoomSceneUIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JsonCMD.ts","./DataWarehouse.ts","./PeopleItemComp.ts","./NetworkManager.ts"],(function(e){var t,n,o,a,r,i,l,s,c,p,u,m,d,b,y,g,f,P;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){r=e.cclegacy,i=e._decorator,l=e.Label,s=e.Node,c=e.Button,p=e.resources,u=e.instantiate,m=e.director,d=e.Component},function(e){b=e.JsonCMD},function(e){y=e.DataWarehouse},function(e){g=e.PeopleItemComp},function(e){f=e.NetworkManager,P=e.networkEventTarget}],execute:function(){var I,S,v,h,C,L,D,_,w,R,M,z,N,G,x,B,k,q,T,E,W,U,F;r._RF.push({},"b32e7saU71Mvq2se3f29n5I","WaittingRoomSceneUIManager",void 0);var O=i.ccclass,j=i.property;e("WaittingRoomSceneUIManager",(I=O("WaittingRoomSceneUIManager"),S=j(l),v=j(l),h=j(l),C=j(l),L=j(l),D=j(l),_=j(l),w=j(s),R=j(c),M=j(c),I((G=t((N=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t=e.call.apply(e,[this].concat(r))||this,o(t,"bombLabel",G,a(t)),o(t,"coinsLabel",x,a(t)),o(t,"zoomPropLabel",B,a(t)),o(t,"nextPropLabel",k,a(t)),o(t,"coinPropLabel",q,a(t)),o(t,"titleLabel",T,a(t)),o(t,"countDownLabel",E,a(t)),o(t,"playerItemGridNode",W,a(t)),o(t,"readyBtn",U,a(t)),o(t,"back2MainBtn",F,a(t)),t.PeopleItemPrefab=void 0,t.isReady=!1,t}n(t,e);var r=t.prototype;return r.start=function(){var e=this;this.initEventTarget(),this.initGameData(y.instance.gameData),p.load("Prefabs/PeopleItem",(function(t,n){t?console.error(t):(e.PeopleItemPrefab=n,e.initPlayerSeats(),console.log("load===PeopleItemPrefab"))})),this.readyBtn.node.on("click",(function(){e.isReady=!e.isReady,e.readyBtn;var t=b.C2S_isReady(e.isReady);f.instance.sendMsg2Server(t);var n=e.readyBtn.node.getChildByName("Label");if(n){var o=n.getComponent(l);o&&(o.string=e.isReady?"取消准备":"准备好了")}}))},r.initGameData=function(e){console.log("initGameData==="+e),this.titleLabel.string=e.curBetCoins+"$ ("+e.curMaxPlayer+"p)",this.bombLabel.string=e.bombCount+"/"+e.maxBombCount,this.coinsLabel.string=y.instance.userDataGened.coins,this.zoomPropLabel.string=e.zoomPropCount+"/"+e.maxZoomPropCount,this.nextPropLabel.string=e.nextPropCount+"/"+e.maxNextPropCount,this.coinPropLabel.string=e.nextPropCount+"/"+e.maxNextPropCount},r.initPlayerSeats=function(){var e=this,t=y.instance.gameData;Object.keys(t.playerDict).forEach((function(n){console.log("sessionId==="+n);var o=t.playerDict[n];e.genPeopleItem2Seat(t,o)})),this.updatePlayerSeatsSeq()},r.genPeopleItem2Seat=function(e,t){var n=u(this.PeopleItemPrefab);this.playerItemGridNode.addChild(n);var o=n.getComponent(g);o.setAvatar(t.avatar),o.sessionId=t.sessionId,o.seatSeq=t.seatSeq,o.setNickName(t.name),e.curPlayerSessinId==t.sessionId?(o.setIsCurrentPlayer(!0),o.setReady(!1),console.log("===set currentplayer=="+e.curPlayerSessinId)):(o.setReady(t.isReady),console.log("===set anotherplayer=="+t.isReady))},r.updatePlayerSeatsSeq=function(){var e=this,t=this.playerItemGridNode.children;t.sort((function(e,t){var n=e.getComponent("PeopleItemComp"),o=t.getComponent("PeopleItemComp");return n.seatSeq-o.seatSeq})),t.forEach((function(t){e.playerItemGridNode.addChild(t)}))},r.initEventTarget=function(){var e=this;P.on(b.CMD_S2C_allReady,(function(e){console.log("eventTarget on==="+b.CMD_S2C_allReady),m.loadScene("GameScene")})),P.on(b.Server_Property_countDownTime,(function(t){console.log("eventTarget on waittingRoomScene===countdowntime"+t),null!=e.countDownLabel&&(e.countDownLabel.string="做好准备，还有 "+t+" 秒剩余")})),P.on(b.Server_Property_playersIn,(function(t){console.log("eventTarget on==="+b.Server_Property_playersIn),e.genPeopleItem2Seat(y.instance.gameData,t),e.updatePlayerSeatsSeq()})),P.on(b.Server_Property_playersOut,(function(t){var n;console.log("eventTarget on==="+b.Server_Property_playersOut),e.playerItemGridNode.children.forEach((function(e){e.getComponent("PeopleItemComp").sessionId!=t.sessionId||(n=e)})),e.playerItemGridNode.remove(n),e.updatePlayerSeatsSeq()})),P.on(b.Server_Property_isReady,(function(t,n){e.playerItemGridNode.children.forEach((function(e){var o=e.getComponent("PeopleItemComp");o.sessionId!=t||o.setReady(n)})),P.on(b.CMD_S2C_startGameFailed,(function(){m.loadScene("MainScene")}))}))},r.update=function(e){},t}(d)).prototype,"bombLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=t(N.prototype,"coinsLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=t(N.prototype,"zoomPropLabel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=t(N.prototype,"nextPropLabel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=t(N.prototype,"coinPropLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(N.prototype,"titleLabel",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=t(N.prototype,"countDownLabel",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=t(N.prototype,"playerItemGridNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=t(N.prototype,"readyBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=t(N.prototype,"back2MainBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=N))||z));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});